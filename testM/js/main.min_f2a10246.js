var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{h(n.next(t))}catch(e){o(e)}}function a(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},State=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addToParent=function(t,e){t.addChild(this),this.isInit||this.init(),this.show(e)},e.prototype.init=function(){this.isInit=!0},e.prototype.show=function(t){},e.prototype.next=function(t,e){this.dispatchEvent(new StateEvent(StateEvent.NEXT,t,e))},e.prototype.popup=function(t,e){this.dispatchEvent(new StateEvent(StateEvent.POPUP,t,e))},e.prototype.returnToLast=function(t){this.dispatchEvent(new StateEvent(StateEvent.LAST,null,t))},e.prototype.tick=function(t){},e.prototype.close=function(){this.parent&&(this.isPopup&&this.dispatchEvent(new StateEvent(StateEvent.POPUPCLOSE,null,null)),this.parent.removeChild(this),this.dispose())},e.prototype.dispose=function(){App.TimerManager.removeAll(this)},e}(egret.DisplayObjectContainer);__reflect(State.prototype,"State",["IState","egret.IEventDispatcher"]);var BaseClass=function(){function t(){}return t.getInstance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this;if(!i._instance){var n=t.length;0==n?i._instance=new i:1==n?i._instance=new i(t[0]):2==n?i._instance=new i(t[0],t[1]):3==n?i._instance=new i(t[0],t[1],t[2]):4==n?i._instance=new i(t[0],t[1],t[2],t[3]):5==n&&(i._instance=new i(t[0],t[1],t[2],t[3],t[4]))}return i._instance},t}();__reflect(BaseClass.prototype,"BaseClass");var GameUser=function(){function t(){this.id=0,this.name="",this.avatar="http://pic.vszone.cn/upload/avatar/1464079970.png",this.token="",this.pValue=0,this.tableID=0,this.isOwner=!1,this.curAvatarType=1,this.ownerId=0,this.maxScore=0}return t}();__reflect(GameUser.prototype,"GameUser");var StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=App.GameWidth,this.stageHeight=App.GameHeight,this.halfStageWidth=this.stageWidth/2,this.halfStageHeight=this.stageHeight/2},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=AssetManager.getBitmap(t),this.background&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var BaseSound=function(){function t(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}return t.prototype.dealSoundTimer=function(){for(var t=egret.getTimer(),e=Object.keys(this._cache),i=0,n=e.length;n>i;i++){var s=e[i];this.checkCanClear(s)&&t-this._cache[s]>=SoundManager.CLEAR_TIME&&(delete this._cache[s],RES.destroyRes(s))}},t.prototype.getSound=function(t){var e=RES.getRes(t);if(e)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.getResAsync(t,this.onResourceLoadComplete,this)}return e},t.prototype.onResourceLoadComplete=function(t,e){var i=this._loadingCache.indexOf(e);-1!=i&&(this._loadingCache.splice(i,1),this._cache[e]=egret.getTimer(),this.loadedPlay(e))},t.prototype.loadedPlay=function(t){},t.prototype.checkCanClear=function(t){return!0},t}();__reflect(BaseSound.prototype,"BaseSound");var qr;!function(t){var e=function(){function t(){this.buffer=[],this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var i=0;e>i;i++)this.putBit(1==(t>>>e-i-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}();t.QRBitBuffer=e,__reflect(e.prototype,"qr.QRBitBuffer")}(qr||(qr={}));var Lobby=function(t){function e(){var e=t.call(this)||this;return e.i=0,e.skinName="resource/mySkins/Lobby.exml",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.selected.getChildAt(0).visible=!0,PcKeyBoardHelper.instance.addListener(this.KeyBoardMethod,this),this.len=this.selected.numChildren},e.prototype.KeyBoardMethod=function(t){if(39==t.keyCode){for(this.i;this.i<this.len;this.i++)if(this.selected.getChildAt(this.i).visible=!0){this.selected.getChildAt(this.i).visible=!1,this.i!=this.len-1?(this.selected.getChildAt(this.i+1).visible=!0,this.i=this.i+1):(this.selected.getChildAt(0).visible=!0,this.i=0);break}}else if(37==t.keyCode){for(this.i;this.i<this.len;this.i++)if(this.selected.getChildAt(this.i).visible=!0){this.selected.getChildAt(this.i).visible=!1,0!=this.i?(this.selected.getChildAt(this.i-1).visible=!0,this.i=this.i-1):(this.selected.getChildAt(2).visible=!0,this.i=2);break}}else if(13==t.keyCode)switch(this.i){case 0:GameSceneView._gameScene.match(0),console.log("匹配模式"),PcKeyBoardHelper.instance.removeListener(this);break;case 1:console.log("xuanze 排位"),GameSceneView._gameScene.match(1),PcKeyBoardHelper.instance.removeListener(this),this.i=0;break;case 2:GameSceneView._gameScene.match(2),PcKeyBoardHelper.instance.removeListener(this),console.log("家庭模式"),this.i=0}},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.height=this.stage.stageHeight,this.initView()},e.prototype.initView=function(){var t=this;this.group.getChildAt(0).addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.showSelected(0),GameSceneView._gameScene.match(0)},this),this.group.getChildAt(1).addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.showSelected(1),GameSceneView._gameScene.match(1)},this),this.group.getChildAt(2).addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.showSelected(2),GameSceneView._gameScene.match(2)},this)},e.prototype.showSelected=function(t){for(var e=0;e<this.selected.numChildren;e++)this.selected.getChildAt(e).visible=e==t},e.canClick=!0,e}(eui.Component);__reflect(Lobby.prototype,"Lobby",["eui.UIComponent","egret.DisplayObject"]);var Login=function(t){function e(){var e=t.call(this)||this;return e.addMsResponseListen(),e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){this.height=this.stage.stageHeight,t.prototype.childrenCreated.call(this),this.loading=Loading.create(this),this.Init()},e.prototype.Init=function(){this.loading.show(),this.CheckSaoMa();mvs.MsEngine.getInstance.init(GameData.CHANNEL,GameData.DEFAULT_ENV,GameData.gameID)},e.prototype.CheckSaoMa=function(){var t=window.location.href,e=t.split("?",20);GameData.roomID=e[1],e.length>1&&(GameData.isSaoMaEnter=!0)},e.prototype.addMsResponseListen=function(){mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_INIT_RSP,this.initResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_REGISTERUSER_RSP,this.registerUserResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_LOGIN_RSP,this.loginResponse,this)},e.prototype.release=function(){mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_INIT_RSP,this.initResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_REGISTERUSER_RSP,this.registerUserResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LOGIN_RSP,this.loginResponse,this)},e.prototype.initResponse=function(t){console.log("initResponse,status:"+t.data.status),200==t.data.status&&mvs.MsEngine.getInstance.registerUser()},e.prototype.registerUserResponse=function(t){var e=t.data;GameData.gameUser.id=e.id,GameData.gameUser.name=e.name,console.log(e.name+"________________________________________"),GameData.gameUser.avatar=e.avatar,GameData.gameUser.token=e.token,0==e.status&&mvs.MsEngine.getInstance.login(e.id,e.token,GameData.gameID,GameData.appkey,GameData.secretKey)},e.prototype.loginResponse=function(t){var e=this;mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LOGIN_RSP,this.loginResponse,this);var i=t.data;console.log("loginResponse, status="+i.status),200!=i.status?console.log("登陆失败"):(console.log("登陆成功 roomID="+i.roomID),"0"!==i.roomID?(GameData.roomID=i.roomID,GameSceneView._gameScene.reconnectView()):setTimeout(function(){e.loading.close(),0==GameData.isSaoMaEnter?GameSceneView._gameScene.lobby():GameSceneView._gameScene.match(4)},500))},e}(eui.Component);__reflect(Login.prototype,"Login",["eui.UIComponent","egret.DisplayObject"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("loading")];case 2:return i.sent(),t=new LoadingUI,this.stage.addChild(t),[4,this.loadTheme()];case 3:return i.sent(),[4,RES.loadGroup("lobby",0,t)];case 4:return i.sent(),[4,this.onResourceLoadComplete()];case 5:return i.sent(),this.stage.removeChild(t),[3,7];case 6:return e=i.sent(),console.error(e),[3,7];case 7:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.onResourceLoadComplete=function(){var t=RES.getRes("dbConfig_json");AssetManager.loadDBAnimation(t.db[0])},e.prototype.createGameScene=function(){LocalStore_Clear(),this._scene=new GameSceneView,this._scene.graphics.beginFill(0),this._scene.graphics.drawRect(this.x,this.y,this.width,this.height),this._scene.graphics.endFill(),this.addChild(this._scene)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var match=function(t){function e(i){var n=t.call(this)||this;return n._isInRoom=!1,n.isOwner=!1,n.canStartGame=!1,n._roomID="",n.default_name="待加入",n.default_rect_color=5592405,n.isOnePlayAgain=!0,n.curSelect=1,n.canRigLef=!1,n.num=0,n.skinName="resource/mySkins/match.exml",e.joinFlag=i,n}return __extends(e,t),e.prototype.showBtn=function(){2==e.joinFlag||3==e.joinFlag?(this.btn_start.visible=!0,this.group_selected.visible=!0,this.wenxintishi.visible=!0,this.wenxintishi.y+this.wenxintishi.height>this.group_btns.y&&(this.group_btns.y=this.wenxintishi.y+this.wenxintishi.height,this.group_selected.y=this.wenxintishi.y+this.wenxintishi.height)):(this.btn_leave.x=this.group_btns.width/2,this.group_selected.getChildAt(0).x=this.btn_leave.x,this.btn_start.visible=!1),PcKeyBoardHelper.instance.addListener(this.KeyBoardMethod,this)},e.prototype.KeyBoardMethod=function(t){if(0==e.joinFlag||1==e.joinFlag)40==t.keyCode?(this.group_selected.getChildAt(0).visible=!0,this.canRigLef=!0):this.canRigLef&&13==t.keyCode&&(this.mbuttonLeaveRoom(),PcKeyBoardHelper.instance.removeListener(this));else if(2==e.joinFlag&&(40==t.keyCode&&(this.group_selected.getChildAt(this.curSelect).visible=!0,this.canRigLef=!0),this.canRigLef&&37==t.keyCode&&(this.group_selected.getChildAt(this.curSelect).visible=!1,this.curSelect=0==this.curSelect?1:0,this.group_selected.getChildAt(this.curSelect).visible=!0),this.canRigLef&&39==t.keyCode&&(this.group_selected.getChildAt(this.curSelect).visible=!1,this.curSelect=1==this.curSelect?0:1,this.group_selected.getChildAt(this.curSelect).visible=!0),this.canRigLef&&13==t.keyCode))switch(this.curSelect){case 0:this.curSelect=1,this.mbuttonLeaveRoom(),PcKeyBoardHelper.instance.removeListener(this);break;case 1:this.canStartGame&&(this.StartGame(),this.curSelect=1,PcKeyBoardHelper.instance.removeListener(this))}},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var i=GameData._playerList.length,n=0;i>n;n++)this.delPlayerList(GameData._playerList[0].id);switch(mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_GETROOMDETAIL_RSP,this.getroomDetails,this),e.joinFlag){case 0:this.joinRandRoom();break;case 1:var s={name:"paiwei",score:"score"};this.joinRoomWithPro(s);break;case 2:this.createRoom();break;case 3:GameData.roomID&&mvs.MsEngine.getInstance.getRoomDetail(GameData.roomID);break;case 4:this.joinWithRoomID(GameData.roomID)}this.initView(),this.btn_leave.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbuttonLeaveRoom,this)},e.prototype.initView=function(){var t=this;this.player1LoadingMask.width=0,this.player2LoadingMask.width=0,this.player1Loading.mask=this.player1LoadingMask,this.player2Loading.mask=this.player2LoadingMask,this.pipeiIng_img.width=this.playerbg1_group.width,this.pipeiIng_img.height=this.playerbg1_group.height,this.StageH=this.stage.stageHeight,this.StageW=this.stage.stageWidth,this.height=this.StageH,this.vX=this.v.x,this.sX=this.s.x,this.v.x=0-this.width,this.s.x=this.width+this.s.width,this.showBtn(),this.addMsResponseListen(),this.strTXT=this.txt.text;var e=0;this.set=setInterval(function(){t.txt.text=t.strTXT.substring(0,e),e++,4==e&&(e=0)},350)},e.prototype.addMsResponseListen=function(){mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINROOM_RSP,this.joinRoomResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINROOM_NTFY,this.joinRoomNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINOVER_NTFY,this.joinOverNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINOVER_RSP,this.joinOverResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINOPEN_RSP,this.joinOpenResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_JOINOPEN_NTFY,this.joinOpenNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SENDEVENT_RSP,this.sendEventResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SENDEVENT_NTFY,this.sendEventNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,this.leaveRoomResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_LEAVEROOM_NTFY,this.leaveRoomNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_CREATEROOM_RSP,this.createRoomResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_KICKPLAYER_RSP,this.kickPlayerResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_KICKPLAYER_NTFY,this.kickPlayerNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_NETWORKSTATE_NTFY,this.networkStateNotify,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SETROOMPROPERTY_RSP,this.setRoomPropertyResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SETROOMPROPERTY_NTFY,this.setRoomPropertynotify,this)},e.prototype.release=function(){mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINROOM_RSP,this.joinRoomResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINROOM_NTFY,this.joinRoomNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINOVER_NTFY,this.joinOverNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINOVER_RSP,this.joinOverResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SENDEVENT_RSP,this.sendEventResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SENDEVENT_NTFY,this.sendEventNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINOPEN_RSP,this.joinOpenResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_JOINOPEN_NTFY,this.joinOpenNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,this.leaveRoomResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LEAVEROOM_NTFY,this.leaveRoomNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_CREATEROOM_RSP,this.createRoomResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_KICKPLAYER_RSP,this.kickPlayerResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_KICKPLAYER_NTFY,this.kickPlayerNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_NETWORKSTATE_NTFY,this.networkStateNotify,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SETROOMPROPERTY_RSP,this.setRoomPropertyResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SETROOMPROPERTY_NTFY,this.setRoomPropertynotify,this)},e.prototype.getroomDetails=function(t){console.log(t.data.owner),GameData.gameUser.id==t.data.owner?GameData.isRoomOwner=!0:GameData.isRoomOwner=!1;for(var e=0;e<t.data.userInfos.length;e++){var i=JSON.parse(t.data.userInfos[e].userProfile);2==t.data.userInfos.length&&2!=GameData._playerList.length?t.data.userInfos[e].userID==GameData.gameUser.id?this.addPlayerList(t.data.userInfos[e].userID,i.name,i.avatar,1,i.curAvatarType,GameData.isRoomOwner):this.addPlayerList(t.data.userInfos[e].userID,i.name,i.avatar,2,i.curAvatarType,GameData.isRoomOwner):1==t.data.userInfos.length&&1!=GameData._playerList.length&&this.addPlayerList(t.data.userInfos[e].userID,i.name,i.avatar,1,i.curAvatarType,GameData.isRoomOwner)}this.playAgain()},e.prototype.playAgain=function(){if(this.isOnePlayAgain){2==GameData._playerList.length?this.num++:1==GameData._playerList.length&&(this.num=0),this._isInRoom=!0,console.log("开始擦除用户信息{{{{{{{{{}}}}}}}}}"),GameData.isRoomOwner&&this.createQRCode();for(var t=0;t<GameData._playerList.length;t++)this.showPlayer(GameData._playerList[t]),console.log(GameData._playerList[t]);this.txtGroup.visible=!1,this.btn_leave.anchorOffsetX=this.btn_leave.width/2,this.btn_start.anchorOffsetX=this.btn_start.width/2,this.btn_leave.x=this.width/2-this.btn_leave.width/2*3,this.btn_start.x=this.width/2+this.btn_start.width/3*2,this.btn_start.visible=!0,this.wenxintishi.visible=!0,this.checkStart(),this.isOnePlayAgain=!1}},e.prototype.joinRandRoom=function(){GameData.isCreateRoom=!1;var t=JSON.stringify({name:GameData.gameUser.name,avatar:GameData.gameUser.avatar});mvs.MsEngine.getInstance.joinRandomRoom(GameData.maxPlayerNum,t)},e.prototype.createRoom=function(){GameData.isCreateRoom=!0;var t=JSON.stringify({name:GameData.gameUser.name,avatar:GameData.gameUser.avatar});mvs.MsEngine.getInstance.createRoom(GameData.createRoomInfo,t)},e.prototype.joinWithRoomID=function(t){var e=JSON.stringify({name:GameData.gameUser.name,avatar:GameData.gameUser.avatar});mvs.MsEngine.getInstance.joinRoom(t,e)},e.prototype.joinRoomWithPro=function(t){var e=JSON.stringify({name:GameData.gameUser.name,avatar:GameData.gameUser.avatar}),i=new MsMatchInfo(GameData.maxPlayerNum,0,0,t);mvs.MsEngine.getInstance.joinRoomWithProperties(i,e)},e.prototype.addPlayerList=function(t,e,i,n,s,o){void 0===o&&(o=!1);var r=new GameUser;return r.id=t,r.name=e,r.avatar=i,r.tableID=n,r.isOwner=o,r.curAvatarType=s,GameData._playerList.push(r),this.showPlayer(r),r},e.prototype.delPlayerList=function(t){for(var e=new GameUser,i=0;i<GameData._playerList.length;i++)GameData._playerList[i].id==t&&(e.id=GameData._playerList[i].id,e.avatar=GameData._playerList[i].avatar,e.name=GameData._playerList[i].name,e.tableID=GameData._playerList[i].tableID,GameData._playerList.splice(i,1),this.wipePlayer(e))},e.prototype.showPlayer=function(t){var e=t.tableID;t.id==GameData.gameUser.id&&(this.player2_name.text=GameData.gameUser.name,this.LoadeAvatar(t.avatar,this.playerbg2_group)),1==e||2==e&&(this.sprite&&(this.saomatip.visible=!1,this.shp.visible=!1,this.sprite.visible=!1),this.pipeiIng_img.texture=RES.getRes("bg2_png"),this.LoadeAvatar(t.avatar,this.playerbg1_group),this.player1_name.text=t.name,this.txtGroup.visible=!1)},e.prototype.wipePlayer=function(t){var e=t.tableID;1==e?(this.pipeiIng_img.texture=RES.getRes("bg1_png"),this.playerbg2_group.getChildByName("touxiang")&&this.playerbg2_group.removeChild(this.playerbg2_group.getChildByName("touxiang"))):2==e&&(this.player1_name.text="",this.pipeiIng_img.texture=RES.getRes("bg1_png"),this.playerbg1_group.getChildByName("touxiang")&&this.playerbg1_group.removeChild(this.playerbg1_group.getChildByName("touxiang")))},e.prototype.wipePlayerLocation=function(t,e){this.num--,this.createQRCode(),this.isOwner=e==GameData.gameUser.id,this.delPlayerList(t);for(var i=0;i<GameData._playerList.length;i++)GameData._playerList[i].isOwner=e==GameData._playerList[i].id,GameData._playerList[i].tableID=i+1},e.prototype.mbuttonLeaveRoom=function(){e.joinFlag=0,clearTimeout(this.ss),this._isInRoom?mvs.MsEngine.getInstance.leaveRoom("累了困了离开一下"):(this.release(),GameSceneView._gameScene.lobby())},e.prototype.btnKickPlayerClick=function(t){var e=0;"btn_kick2"==t.target.name?e=2:"btn_kick3"==t.target.name&&(e=3);var i=this.getUserForTableID(e);return null==i?void console.info("用户不存在"):void mvs.MsEngine.getInstance.kickPlayer(i.id,"我们不能一起好好的玩游戏")},e.prototype.getUserForTableID=function(t){var e=null;return GameData._playerList.forEach(function(i){i.tableID==t&&(e=i)}),e},e.prototype.leaveRoomNotify=function(t){var i=t.data;console.info("玩家离开",i);var n=i.userId;i.owner==GameData.gameUser.id?(this.isOwner=!0,GameData.isRoomOwner=!0):this.isOwner=!1,this.delPlayerList(n),this.canStartGame=!1,0==e.joinFlag||1==e.joinFlag?this.txtGroup.visible=!0:(2==e.joinFlag||3==e.joinFlag||4==e.joinFlag)&&(this.player1_name.text="",this.createQRCode());for(var s=0;s<GameData._playerList.length;s++)i.owner==GameData._playerList[s].id?GameData._playerList[s].isOwner=!0:GameData._playerList[s].isOwner=!1,GameData._playerList[s].tableID=s+1,this.showPlayer(GameData._playerList[s])},e.prototype.leaveRoomResponse=function(t){this.delPlayerList(t.data.userId);var e=t.data;200!==e.status?console.log("退出房间失败！status="+e.status):(this.release(),console.log("闯哥牛逼"),GameSceneView._gameScene.lobby())},e.prototype.createRoomResponse=function(t){var e=t.data;if(200==e.status){console.log("创建房间成功###############################");var i=1;this.addPlayerList(GameData.gameUser.id,GameData.gameUser.name,GameData.gameUser.avatar,i,GameData.gameUser.curAvatarType,this.isOwner),this._roomID=e.roomID,GameData.roomID=e.roomID,this._isInRoom=!0,this.createQRCode(),this.txtGroup.visible=!1,e.owner==GameData.gameUser.id?(this.isOwner=!0,GameData.isRoomOwner=!0):this.isOwner=!1}else console.info("加入房间失败",e)},e.prototype.joinRoomResponse=function(t){var e=t.data,i=this;if(200==e.status){GameData.gameUser.ownerId=e.owner,e.roomInfo.ownerId==GameData.gameUser.id?(this.isOwner=!0,GameData.isRoomOwner=!0,this.ss=setTimeout(function(){0==i.num&&i.GameAI()},5e3)):this.isOwner=!1,this._roomID=e.roomInfo.roomID,GameData.roomID=e.roomInfo.roomID,this._isInRoom=!0,GameData.gameUser.isOwner=!1;var n=1;this.addPlayerList(GameData.gameUser.id,GameData.gameUser.name,GameData.gameUser.avatar,n,GameData.gameUser.curAvatarType,this.isOwner);for(var s=e.userList,o=0;o<s.length;o++)n++,this.otherJoinShowInfo(s[o].userId,n,s[o].userProfile,e.roomInfo.ownerId==s[o].userId);this.checkStart()}else console.info("加入房间失败",e)},e.prototype.checkStart=function(){var t=this;console.info("房间人数："+GameData._playerList.length),GameData._playerList.length==GameData.maxPlayerNum?(console.info("可以开始游戏"),console.log(GameData.isRoomOwner),1==GameData.isRoomOwner&&(this.sprite?(this.canStartGame=!0,this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.StartGame(),t.btn_start.enabled=!1},this)):(this.canStartGame=!0,this.StartGame()))):this.canStartGame=!1},e.prototype.otherJoinShowInfo=function(t,e,i,n){if(void 0===n&&(n=!1),i&&""!==i){var s="",o="",r=JSON.parse(i);r.name&&(s=r.name),r.avatar&&(o=r.avatar),this.addPlayerList(t,s,o,e,r.curAvatarType,n)}},e.prototype.joinRoomNotify=function(t){this.num++,clearTimeout(this.ss);var e=t.data,i=(e.userId,GameData._playerList.length+1);this.otherJoinShowInfo(e.userId,i,e.userProfile,e.userId==e.owner),this.checkStart()},e.prototype.notifyGameStart=function(){this.btn_leave.visible=!1,e.canClick=!1,this.group_selected.visible=!1,this.btn_leave.enabled=!1,1==this.isOwner;var t=[];GameData._playerList.forEach(function(e){t.push({id:e.id,name:e.name,avatar:e.avatar})});var i={action:GameData.gameStartEvent,userIds:t},n=mvs.MsEngine.getInstance.sendEvent(JSON.stringify(i));return 0!==n.result?console.log("发送游戏开始通知失败，错误码"+n.result):(GameData.events[n.sequence]=i,void console.log("发起游戏开始的通知，等待回复"))},e.prototype.StartGame=function(){this.btn_start.visible=!1,this.group_selected.visible=!1,GameData._playerList.length>=GameData.maxPlayerNum?(GameData.playerUserIds=GameData._playerList,console.log("停止加入房间"),mvs.MsEngine.getInstance.joinOver("joinOver")):console.log("人不够，或者还有人没有准备！")},e.prototype.sendEventResponse=function(t){var e=t.data;if(200!==e.status)return console.log("事件发送失败,status:"+status);var i=GameData.events[e.sequence];i&&i.action===GameData.gameStartEvent&&(delete GameData.events[e.sequence],this.release(),GameSceneView._gameScene.play(),PcKeyBoardHelper.instance.removeListener(this))},e.prototype.sendEventNotify=function(t){var e=t.data;e&&e.cpProto&&e.cpProto.indexOf(GameData.gameStartEvent)>=0&&(GameData.playerUserIds=GameData._playerList,this.release(),PcKeyBoardHelper.instance.removeListener(this),GameSceneView._gameScene.play())},e.prototype.joinOverResponse=function(t){var i=t.data;if(200===i.status){if(this.btn_leave.visible=!1,e.canClick=!1,PcKeyBoardHelper.instance.removeListener(this),this.group_selected.visible=!1,this.canStartGame&&1==this.num)return this.loadGameSource(),void(GameData.playerUserIds=GameData._playerList);1==App.CurrGameIsAi&&this.loadGameSource()}else console.log("关闭房间失败，回调通知错误码：",i.status);Toast.show(" 设置不允许房间加人 "+(200==i.status?"success":"fail"))},e.prototype.joinOverNotify=function(t){this.loadGameSource();var e=t.data;console.log("userID:"+e.userID+" 关闭房间："+e.roomID+" cpProto:"+e.cpProto),Toast.show(e.userID+" 设置了不允许房间加人")},e.prototype.joinOpenResponse=function(t){var e=t.data;Toast.show(" 设置允许房间加人 "+(200==e.status?"success":"fail"))},e.prototype.joinOpenNotify=function(t){var e=t.data;Toast.show(e.userID+" 设置了允许房间加人")},e.prototype.cancelStart=function(t,e){this.canStartGame=!1},e.prototype.kickPlayerResponse=function(t){var e=t.data;this.cancelStart(e.userID,this._roomID),this.wipePlayerLocation(e.userID,e.owner)},e.prototype.kickPlayerNotify=function(t){var e=t.data;console.info("玩家离开",e),e.userID==GameData.gameUser.id?(this.release(),GameSceneView._gameScene.lobby()):(this.cancelStart(e.userID,this._roomID),this.wipePlayerLocation(e.userID,e.owner))},e.prototype.networkStateNotify=function(t){var e=t.data,i=e.userID;this.cancelStart(i,e.roomID),(e.state=1)?(console.info("玩家断开:"+i),mvs.MsEngine.getInstance.kickPlayer(i,"玩家断线踢掉")):2==e.state?console.info("玩家正在从新连接..."+i):(console.info("玩家离开"+i),this.wipePlayerLocation(e.userID,e.owner))},e.prototype.setRoomPropertynotify=function(t){var e=t.data;console.log("roomProperty = "+e.roomProperty),e.roomProperty===GameData.roomPropertyType.mapB?GameData.roomPropertyValue=GameData.roomPropertyType.mapB:GameData.roomPropertyValue=GameData.roomPropertyType.mapA},e.prototype.setRoomPropertyResponse=function(t){console.log("roomProperty = "+t.data.roomProperty)},e.prototype.CreateVsImg=function(){var t=this;clearInterval(this.set),egret.Tween.get(this.shandian).to({alpha:1},1e3),egret.Tween.get(this.v).to({x:this.vX},1e3,egret.Ease.quartOut),egret.Tween.get(this.s).to({x:this.sX},1e3,egret.Ease.quartOut).wait(300).call(function(){GameData.isRoomOwner?t.notifyGameStart():1==App.CurrGameIsAi&&GameSceneView._gameScene.play()})},e.prototype.loadGameSource=function(){var t=this;egret.Tween.get(this.player1LoadingMask).to({width:this.player1Loading.width},1e3),egret.Tween.get(this.player2LoadingMask).to({width:this.player1Loading.width},1e3).call(function(){t.CreateVsImg()});var e=0;setInterval(function(){100>e&&(e+=10,t.player2loadingtxt.text=e.toString()+"%",t.player1loadingtxt.text=e.toString()+"%")},100)},e.prototype.LoadeAvatar=function(t,e){var i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(t),i.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var i=new egret.Texture;i.bitmapData=t.currentTarget.data;var n=new egret.Bitmap(i);n.width=n.height=100,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,e.addChild(n),n.name="touxiang",n.x=e.width/2,n.y=e.height/2}},this)},e.prototype.createQRCode=function(){this.shp=new egret.Shape,this.shp.graphics.beginFill(16777215,1),this.shp.graphics.drawRect(0,0,this.playerbg1_group.height/4*3,this.playerbg1_group.height/4*3),this.shp.anchorOffsetX=this.shp.width/2,this.shp.anchorOffsetY=this.shp.height/2,this.shp.graphics.endFill(),this.shp.x=this.qrcodebg.x,this.shp.y=this.playerbg1_group.height/2-20,this.playerbg1_group.addChild(this.shp);var t=window.location.host;this.sprite=qr.QRCode.create("http://"+t+"/index.html?"+GameData.roomID,50,this.shp.width,this.shp.height),console.log("http://"+t+"/index.html?roomid="+GameData.roomID),console.log(this.qrcodebg.anchorOffsetX,this.qrcodebg.anchorOffsetY+"}}}}}}}}}}}}}}}}}}}}}}}}}}"),this.sprite.anchorOffsetX=this.sprite.width/2,this.sprite.anchorOffsetY=this.sprite.height/2,this.playerbg1_group.addChild(this.sprite),this.sprite.x=this.qrcodebg.x,this.sprite.y=this.shp.y,this.saomatip.y=this.shp.y+this.shp.height/2,this.saomatip.visible=!0},e.prototype.GameAI=function(){console.log("匹配5s"),App.CurrGameIsAi=!0,mvs.MsEngine.getInstance.joinOver("joinOver");var t=new GameUser;t.id="12138",t.name="游客12138",t.avatar="resource/assets/egret_icon.png",t.tableID=2,t.isOwner=!1,GameData._playerList.push(t),this.showPlayer(t)
},e.joinFlag=0,e.canClick=!0,e}(eui.Component);__reflect(match.prototype,"match",["eui.UIComponent","egret.DisplayObject"]);var PcKeyBoardHelper=function(){function t(){this.isListening=!1,this.list={}}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.add=function(){0==this.isListening&&(this.isListening=!0,document.addEventListener("keydown",t.instance.onKeyDown))},t.prototype.onKeyDown=function(e){console.log("evt.keyCode:"+e.keyCode);var i;for(i in t.instance.list){var n=t.instance.list[i];n.callback.call(n.target,e)}},t.prototype.addListener=function(e,i){var n=egret.getQualifiedClassName(i);if(null==t._instance.list[n]){var s=new KeyVo(n,i,e);t._instance.list[s.name]=s}t._instance.add()},t.prototype.removeListener=function(e){var i=egret.getQualifiedClassName(e);null!=t._instance.list[i]&&delete t._instance.list[i],this.checkCount()},t.prototype.checkCount=function(){for(var e in t._instance.list)return;document.removeEventListener("keydown",t.instance.onKeyDown),this.isListening=!1},t}();__reflect(PcKeyBoardHelper.prototype,"PcKeyBoardHelper");var KeyVo=function(){function t(t,e,i){this.name="",this.name=t,this.target=e,this.callback=i}return t}();__reflect(KeyVo.prototype,"KeyVo");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LanguageType=function(){function t(){}return t.En="_En",t.Ch="",t}();__reflect(LanguageType.prototype,"LanguageType");var App=function(){function t(){}return Object.defineProperty(t,"TimerManager",{get:function(){return TimerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ResourceUtils",{get:function(){return ResourceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SoundManager",{get:function(){return SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StageUtils",{get:function(){return StageUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DisplayUtils",{get:function(){return DisplayUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GameWidth",{get:function(){return t.StageUtils.getWidth()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GameHeight",{get:function(){return t.StageUtils.getHeight()},enumerable:!0,configurable:!0}),t.Proto=null,t.Language=LanguageType.Ch,t.UserToken="",t.CurrChatId="",t.CurrGameId=1,t.CurrGameIsAi=!1,t.CurrGameAiLevel=3,t.CurrRoomId="",t.CurrPlatformUid="",t}();__reflect(App.prototype,"App");var DBArmature=function(t){function e(e){var i=t.call(this)||this;return i._displayEvents=[],i._armature=e,i._armatureDisplay=e.display,i.dealClock(i),i.addChild(i._armatureDisplay),i}return __extends(e,t),e.prototype.dealClock=function(t){var e=this,i=t.$onAddToStage.bind(t);t.$onAddToStage=function(t,n){i(t,n),e.$addToClock()};var n=t.$onRemoveFromStage.bind(t);t.$onRemoveFromStage=function(){n(),e.$removeFromClock()}},e.prototype.addToClock=function(t){this._curClock||(this._curClock=t,this._curClock.add(this._armature))},e.prototype.$addToClock=function(){this.addToClock(dragonBones.EgretFactory.factory.clock)},e.prototype.$removeFromClock=function(){this._curClock&&(this._curClock.remove(this._armature),this._curClock=null)},e.prototype.getRunDbNum=function(){var t=dragonBones.EgretFactory.factory.clock._animatebles,e={};return t.forEach(function(t){if(t){var i=t.armatureData.name;e[i]||(e[i]=0),e[i]++}}),JSON.stringify(e)},e.prototype.gotoAndStop=function(t){this._currAction=t,this._armature.animation.gotoAndStopByFrame(t)},e.prototype.gotoAndStopByTime=function(t,e){this._currAction=t,this._armature.animation.gotoAndStopByTime(t,e)},e.prototype.gotoAndStopByProgress=function(t,e){this._currAction=t,this._armature.animation.gotoAndStopByProgress(t,e)},e.prototype.play=function(t,e){return void 0===e&&(e=0),this._currAction=t,this._armature.animation.play(t,e)},Object.defineProperty(e.prototype,"currAction",{get:function(){return this._currAction},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._armature.animation.stop()},e.prototype.replaceSlot=function(t,e){var i=this._armature.getSlot(t);i&&(i.display=e)},e.prototype.replaceTexture=function(t){this._armature.replaceTexture(t)},e.prototype.replaceSkin=function(t){AssetManager.dbFactory.replaceSkin(this._armature,t)},Object.defineProperty(e.prototype,"armatureName",{get:function(){return this._armature.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeScale",{get:function(){return this._armature.animation.timeScale},set:function(t){this._armature&&(this._armature.animation.timeScale=t)},enumerable:!0,configurable:!0}),e.prototype.getSlot=function(t){return this._armature.getSlot(t)},e.prototype.getBone=function(t){return this._armature.getBone(t)},e.prototype.once=function(t,e,i){this._armatureDisplay.once(t,e,i)},e.prototype.addDisplayEvent=function(t,e,i){this._armatureDisplay.addEvent(t,e,i),this._displayEvents.push([t,e,i])},e.prototype.removeDisplayEvent=function(t,e,i){this._armatureDisplay.removeEvent(t,e,i)},e.prototype.removeAllDisplayEvent=function(){for(;this._displayEvents.length;){var t=this._displayEvents.pop();this.removeDisplayEvent(t[0],t[1],t[2])}},e.prototype.dispose=function(){this._armature&&(AssetManager.removeCacheArmature(this),this.$removeFromClock(),this.removeAllDisplayEvent(),egret.Tween.removeTweens(this),this._armature.dispose(),this._armature=null,this._armatureDisplay=null)},e}(egret.DisplayObjectContainer);__reflect(DBArmature.prototype,"DBArmature");var DBProgress=function(t){function e(e){var i=t.call(this)||this;return i._armature=e,i._armature.gotoAndStop("progress"),i.addChild(i._armature),i}return __extends(e,t),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this._progress>1&&(this._progress=1),this._progress<0&&(this._progress=0),this._armature.gotoAndStopByProgress("progress",this._progress)},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(DBProgress.prototype,"DBProgress");var GameData=function(){function t(){}return t.init=function(){this.isGameOver=!0,this.isRoomOwner=!1,this.syncFrame=!1,this.number1="",this.number2="",this.number3="",this.roomID="",this.intervalList=[],this.playerUserIds=[],this.roomPropertyValue=this.roomPropertyType.mapA},t.configEnvir=function(e,i){t.CHANNEL=e,t.DEFAULT_ENV=i?t.ENVIRONMENT.dev:t.ENVIRONMENT.pro,"MatchVS"===e&&(t.gameID=201150,t.appkey="0db8550d9bd345da82b852564f59d2e6",t.secretKey="15bf7e1bc2454d21b071d67f568e257c"),"MatchVS-Test"===e&&(t.gameID=201170,t.appkey="a5b937f29a4c480bb6946093105c0565",t.secretKey="a8c5c84afde44136a5eea6f0ac09887c"),"MatchVS-Test1"===e&&(t.gameID=201078,t.appkey="938e1ee0db444a079fe0695598677ba0",t.secretKey="9b11e0eca09141a1961d49d6b6028075")},t.getBindOpenIDAddr=function(t,e){if("MatchVS"==t||"Matchvs"==t){if("release"==e)return"http://vsuser.matchvs.com/wc6/thirdBind.do?";if("alpha"==e)return"http://alphavsuser.matchvs.com/wc6/thirdBind.do?"}else if("MatchVS-Test1"==t){if("release"==e)return"http://zwuser.matchvs.com/wc6/thirdBind.do?";if("alpha"==e)return"http://alphazwuser.matchvs.com/wc6/thirdBind.do?"}},t.getSign=function(e){var i=t.appkey+"&"+e+"&"+t.secretKey;console.info("待签名："+i);var n=(new MD5).hex_md5(i);return n},t.CHANNEL="MatchVS",t.DEFAULT_ENV="alpha",t.ENVIRONMENT={dev:"alpha",pro:"release"},t.gameID=202483,t.appkey="716618c7a16244c9822b4a4046de61b8#E",t.secretKey="79f12031295347ba96d6e08722efb5d7",t.gameUser=new GameUser,t.playerUserIds=[],t.matchType=0,t.randomMatch=1,t.specialMatch=2,t.tagsMatch=3,t.maxPlayerNum=2,t.isRoomOwner=!1,t._playerList=[],t.isCreateRoom=!1,t.gameStartEvent="gameStart",t.gameOverEvent="gameOver",t.playerPositionEvent="playerPosition",t.reconnectStartEvent="gameReconnectStart",t.newStarEvent="newStar",t.changeStarEvent="changeStar",t.gameReadyEvent="gameReady",t.reconnectReadyEvent="gameReconnectReady",t.events={},t.syncFrame=!1,t.isGameOver=!1,t.starPositionX=0,t.starPositionY=0,t.frameRate=20,t.defaultHeight=400,t.roomID="",t.isSaoMaEnter=!1,t.intervalList=[],t.number1="",t.number2="",t.number3="",t.playerTime=60,t.roomPropertyType={mapA:"mapA",mapB:"mapB"},t.roomPropertyValue="mapA",t.createRoomInfo=new MsCreateRoomInfo("MatchvsDemoEgret",2,0,0,1,"mapA"),t}();__reflect(GameData.prototype,"GameData");var gameLoading=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.img.texture=RES.getRes("loading_png"),this.addChild(this.img),this.img.scaleX=0,RES.loadGroup("preload"),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,function(){},this)},e.prototype.onProgress=function(t,e){this.scaleX=t/e},e}(egret.Sprite);__reflect(gameLoading.prototype,"gameLoading");var GameKingkong=function(t){function e(){var e=t.call(this)||this;return e.masterScore=0,e._uiContainer=new egret.DisplayObjectContainer,e._progress1=new DBProgress(AssetManager.getDBArmature("progress1")),e._progress2=new DBProgress(AssetManager.getDBArmature("progress2")),e.init(),e}return __extends(e,t),e.prototype.KeyBoardMethod=function(t){e.canClick&&(38==t.keyCode?this._sceneLeft.touchRight():13==t.keyCode&&this._sceneLeft.touchLeft())},e.prototype.init=function(){t.prototype.init.call(this),PcKeyBoardHelper.instance.addListener(this.KeyBoardMethod,this),mvs.MsEngine.getInstance.setFrameSync(GameData.frameRate),this.bg="bg_jpg",this.background.height>App.GameHeight&&(this.background.height=App.GameHeight,this.background.anchorOffsetY=this.background.height/2,this.background.y=App.GameHeight/2),App.GameHeight>this.background.height&&(this.background.height=App.GameHeight,this.background.anchorOffsetY=this.background.height/2,this.background.y=App.GameHeight/2);var e=AssetManager.getBitmap("blackMask_png",!1,!1);e.width=e.height=App.GameWidth,e.anchorOffsetY=e.height,e.y=(App.GameHeight-this.background.height)/2;var i=AssetManager.getBitmap("blackMask_png",!1,!1);i.width=i.height=App.GameWidth,i.y=App.GameHeight-(App.GameHeight-this.background.height)/2,this._sceneLeft=new KingkongScene(this.background.width,this.background.height,!0),this._sceneRight=new KingkongScene(this.background.width,this.background.height),App.SoundManager.playBg("kingkongBgMusic_mp3"),App.CurrGameIsAi?this._sceneRight.mode=KingkongScene.MODE_AI:this._sceneRight.mode=KingkongScene.MODE_NET,this._sceneRight.self=!1,this._sceneRight.scaleX=-1,this._sceneRight.scaleY=-1,this._sceneRight.x=this.background.width,this._sceneRight.y=this.background.height+(App.GameHeight-this.background.height)/2,this._uiContainer.width=this.background.width,this._uiContainer.height=this.background.height,this._uiContainer.anchorOffsetY=this._uiContainer.height/2,this._uiContainer.anchorOffsetX=this._uiContainer.width/2,this._uiContainer.x=App.GameWidth/2,this._uiContainer.y=App.GameHeight/2,this._conBitmap=AssetManager.getBitmap("spaceBg_png",!1,!1),this._conBitmap.width=App.GameWidth,this._conBitmap.height=App.GameHeight,this.addChild(this._conBitmap),this._sceneLeft.y=(App.GameHeight-this.background.height)/2,this.addChild(this._sceneRight),this.addChild(this._sceneLeft),this.addChild(this._uiContainer),this._progress1.x=this.background.width,this._progress1.y=this.background.height/2,this._progress1.rotation=90,this._progress2.x=this.background.width,this._progress2.y=this.background.height/2,this._progress2.rotation=90,this._uiContainer.addChild(this._progress2),this._uiContainer.addChild(this._progress1);var n=AssetManager.getBitmap("mask_png");n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height,n.x=this._progress1.x-5,n.y=this._progress1.y-280,this._uiContainer.addChild(n);var s=AssetManager.getBitmap("mask_png");s.anchorOffsetX=s.width/2,s.anchorOffsetY=0,s.x=this._progress1.x-5,s.y=this._progress1.y+280,this._uiContainer.addChild(s);var o=AssetManager.getBitmap("winLine_jpg");o.anchorOffsetX=o.width/2,o.anchorOffsetY=0,o.x=this._progress1.x+1,o.y=this._progress1.y-270,this._uiContainer.addChild(o),this.addChild(e),this.addChild(i),this._conBitmap.touchEnabled=!0,this._conBitmap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.addEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.addEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.addEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneRight.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BANANA,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_JUMP,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT_GROUND,this.onMasterEvent,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SENDEVENT_NTFY,this.onGameEvent,this)},e.prototype.onMasterEvent=function(t){var e=[];if(GameData.playerUserIds.forEach(function(t){e.push(t.id)}),this._sceneRight.mode==KingkongScene.MODE_NET){t.data;switch(t.type){case KingkongScene.EVENT_BOOM:mvs.MsEngine.getInstance.sendEvent("boom");break;case KingkongScene.EVENT_GET_BANANA:mvs.MsEngine.getInstance.sendEvent("getBanana");break;case KingkongScene.EVENT_GET_BOOM:mvs.MsEngine.getInstance.sendEvent("getBoom");break;case KingkongScene.EVENT_JUMP:mvs.MsEngine.getInstance.sendEvent("jump");break;case KingkongScene.EVENT_SHOOT:mvs.MsEngine.getInstance.sendEvent("shoot");break;case KingkongScene.EVENT_SHOOT_GROUND:}}},e.prototype.onGameEvent=function(t){var e=t.data;switch(e.cpProto){case"getBoom":this._sceneRight.kingkongGetBoom();break;case"getBanana":this._sceneRight.kingkongGetBanana();break;case"boom":this._sceneRight.kingkongHit();break;case"jump":this._sceneRight.kingkongJump();break;case"shoot":this._sceneRight.kingkongShoot()}},e.prototype.stop=function(){this.isStop||(egret.stopTick(this.tick,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SENDEVENT_NTFY,this.onGameEvent,this),this.isStop=!0,this._progress1.progress=0,this._progress2.progress=0,this._sceneLeft.dispose(),this._sceneRight.dispose())},e.prototype.onGameOver=function(t){this.stop(),App.CurrGameIsAi?GameSceneView._gameScene.gameResult(this._win):GameSceneView._gameScene.gameResult(this._win),this.dispose()},e.prototype.onGameResult=function(t){"1"===t.data.cpProto&&(console.log("masterWIN"),this.addChild(new GameResultView(1))),"3"===t.data.cpProto&&(console.log("shadiaoWIN"),this.addChild(new GameResultView(3)))},e.prototype.onGameStart=function(t){var e=this;this._win=1,this._sceneRight.startRun(),egret.startTick(this.tick,this),this._sceneLeft.gameStart&&(this.Interval_100ms=setInterval(function(){e.masterScore+=.1},this,100))},e.prototype.onLeftWin=function(t){this._win=1;var e=this.masterScore.toFixed(1);GameData.gameUser.curscore=Number(e),clearInterval(this.Interval_100ms),this._sceneRight.fail()},e.prototype.onRightWin=function(t){this._win=3,this._sceneLeft.fail()},e.prototype.onLeftShoot=function(t){this._sceneLeft.fireBoom(this._sceneRight.addBoom)},e.prototype.onRightShoot=function(t){this._sceneRight.fireBoom(this._sceneLeft.addBoom)},e.prototype.onTouchBegin=function(t){t.stageX<this.background.width/2?t.stageY>this.background.height/4?this._sceneLeft.touchLeft():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchRight():t.stageY>this.background.height/4?this._sceneLeft.touchRight():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchLeft()},e.prototype.tick=function(t){return this._sceneLeft.gameStart&&(this._progress2&&(this._progress2.progress=this._sceneLeft.progress),this._progress1&&(this._progress1.progress=this._sceneRight.progress)),!0},e.prototype.dispose=function(){e.canClick=!1,PcKeyBoardHelper.instance.removeListener(this),this._conBitmap.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.removeEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.removeEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneRight.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.dispose(),this._sceneRight.dispose(),ObjectPool.clearClass("KingkongItem")},e.canClick=!0,e}(StateBG);__reflect(GameKingkong.prototype,"GameKingkong");var GameResultView=function(t){function e(e){var i=t.call(this)||this;return i.particlesArr=[],i.isAgain=!1,i.curSelect=1,i.canLefRig=!1,i.isAgain=!1,0==match.joinFlag||1==match.joinFlag||GameData.isSaoMaEnter?mvs.MsEngine.getInstance.leaveRoom("bye"):GameData.isCreateRoom&&mvs.MsEngine.getInstance.joinOpen("加入吧"),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,i.leaveRoomResponse,i),i.skinName="resource/mySkins/GameResultSkin.exml",i.winNumber=e,i.addEventListener(eui.UIEvent.CREATION_COMPLETE,i.onComplete,i),PcKeyBoardHelper.instance.addListener(i.KeyBoardMethod,i),i.init(),i}return __extends(e,t),e.prototype.init=function(){this.y=-this.height,egret.Tween.get(this).to({y:0},1e3,egret.Ease.backInOut)},e.prototype.KeyBoardMethod=function(t){if(40==t.keyCode&&(this.canLefRig=!0,this.group_selected.getChildAt(this.curSelect).visible=!0),(this.canLefRig&&37==t.keyCode||39==t.keyCode)&&(this.group_selected.getChildAt(this.curSelect).visible=!1,this.curSelect=0==this.curSelect?1:0,this.group_selected.getChildAt(this.curSelect).visible=!0),this.canLefRig&&13==t.keyCode)switch(this.curSelect){case 0:this.onLevelClick(),this.curSelect=1,PcKeyBoardHelper.instance.removeListener(this);break;case 1:this.onAgaginClick(),PcKeyBoardHelper.instance.removeListener(this)}},e.prototype.onComplete=function(){this.height=this.stage.stageHeight,this.btn_again.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onAgaginClick,this),this.btn_leave.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLevelClick,this),this.showResult()},e.prototype.onLevelClick=function(){PcKeyBoardHelper.instance.removeListener(this),this.dispose(),match.joinFlag=0,e.canClick=!1,mvs.MsEngine.getInstance.leaveRoom("zoule"),GameSceneView._gameScene.lobby()},e.prototype.showResult=function(){this.lab_myName.text=GameData.gameUser.name;for(var t=0;t<GameData._playerList.length;t++)GameData._playerList[t].isOwner||(this.lab_otherName.text=GameData._playerList[t].name);3==this.winNumber?(this.img_result1.source="loseBG_png",this.img_result2.source="winBG_png",this.onParticleEffect(this.gp_particle.width/2+400,this.gp_particle.height/2,"hua"),this.onParticleEffect(this.gp_particle.width/2-400,this.gp_particle.height/2,"falisnow")):1==this.winNumber&&(this.checkMaxScore(),this.img_result1.source="winBG_png",this.img_result2.source="loseBG_png",this.onParticleEffect(this.gp_particle.width/2-400,this.gp_particle.height/2,"hua"),this.onParticleEffect(this.gp_particle.width/2+400,this.gp_particle.height/2,"falisnow")),this.addPerson()},e.prototype.checkMaxScore=function(){GameData.gameUser.curscore>GameData.gameUser.maxScore&&(this.onParticleEffect(0,0,"flowers"),GameData.gameUser.maxScore=GameData.gameUser.curscore)},e.prototype.onAgaginClick=function(){this.dispose(),PcKeyBoardHelper.instance.removeListener(this),e.canClick=!1,1==GameData.isCreateRoom?GameSceneView._gameScene.match(3):0==match.joinFlag?GameSceneView._gameScene.match(0):GameData.isSaoMaEnter?GameSceneView._gameScene.match(4):1==match.joinFlag&&GameSceneView._gameScene.match(1)},e.prototype.leaveRoomResponse=function(t){var e=t.data;200!==e.status?console.log("退出房间失败！status="+e.status):mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,this.leaveRoomResponse,this)},e.prototype.onParticleEffect=function(t,e,i,n,s){void 0===n&&(n=-1),void 0===s&&(s=1);var o=RES.getRes(i+"_png"),r=RES.getRes(i+"_json"),a=new particle.GravityParticleSystem(o,r);if(this.particlesArr.push(a),a.y=e,a.x=t,a.scaleX=s,"flowers"==i?(this.group_flower.addChild(a),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2):this.gp_particle.addChild(a),a.start(n),"hua"==i)for(var h=2;7>h;h++){i="hua"+h;var o=RES.getRes(i+"_png"),r=RES.getRes("hua_json"),a=new particle.GravityParticleSystem(o,r);this.particlesArr.push(a),a.y=e,a.x=t,a.scaleX=s,this.gp_particle.addChild(a),a.start(n)}},e.prototype.addPerson=function(){this.roleAvatar1=this.createAvatar(this.gp_people1,!0),this.roleAvatar2=this.createAvatar(this.gp_people2,!1);GameData.gameUser;this.addDBresult(),this.dbResult1.visible=!0,this.dbResult2.visible=!0,1==this.winNumber?(this.dbResult1.play("win",1),this.dbResult2.play("loser",1),this.roleAvatar1.armature.play("win"),this.roleAvatar2.armature.play("Loser2"),App.SoundManager.playEffect("win_mp3")):3==this.winNumber&&(this.dbResult2.play("win",1),this.dbResult1.play("loser",1),this.roleAvatar2.armature.play("win"),this.roleAvatar1.armature.play("Loser2"),App.SoundManager.playEffect("lose_mp3"),App.SoundManager.muteBg())},e.prototype.createAvatar=function(t,e){t.removeChildren();var i,n;if(e)n=GameData.gameUser;else for(var s=0;s<GameData._playerList.length;s++)GameData._playerList[s].id!=GameData.gameUser.id&&(n=GameData._playerList[s]);return i=new RoleAvatar(n.curAvatarType,n.avatar),i.armature.x=.5*t.width,i.armature.y=t.height,t.addChild(i.armature),i},e.prototype.addDBresult=function(){this.dbResult1=AssetManager.getQuickDBArmature("winloser"),this.dbResult2=AssetManager.getQuickDBArmature("winloser"),this.gp_wenzi.addChild(this.dbResult1),this.gp_wenzi.addChild(this.dbResult2),this.dbResult1.x=this.gp_wenzi.width/2-400,this.dbResult2.x=this.gp_wenzi.width/2+400,this.dbResult1.y=this.gp_wenzi.height/2-100,this.dbResult2.y=this.gp_wenzi.height/2-100,this.dbResult1.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayResultComplete,this),this.dbResult1.visible=!1,this.dbResult2.visible=!1},e.prototype.onPlayResultComplete=function(){var t=this;this.dbResult1.visible=!1,this.dbResult2.visible=!1,setTimeout(function(){for(var e=0;e<t.particlesArr.length;e++)t.particlesArr[e].stop()},5e3)},e.prototype.dispose=function(){this.dbResult1.dispose(),this.dbResult2.dispose(),this.roleAvatar1.dispose(),this.roleAvatar2.dispose()},e.canClick=!0,e}(eui.Component);__reflect(GameResultView.prototype,"GameResultView");var KingkongScene=function(t){function e(e,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=null);var o=t.call(this)||this;o._totalDistance=35570,o._curItemConfigs=[],o._curItems=[],o._kingkongPosMinY=1521,o._kingkongPosMaxY=1900,o._fastLastTime=3,o.self=!0,o._kingkongOffsetY=65,o._kingkongOffsetX=240,o._curLevel=1,o._invincibleTime=0,o.progress=0,o.fireBoom=function(t){var e=ObjectPool.pop(KingkongItem,"KingkongItem");e.type=KingkongItem.TYPE_FIRE_BOOM,e.x=0,o.master?(e.y=o.stageWidth-o._kingkong.x,App.SoundManager.playEffect("renglei2_mp3",!0)):(e.y=o.stageWidth-o._kingkong.x,App.SoundManager.playEffect("renglei_mp3",!0)),o._itemContainer.addChild(e);var i=egret.Tween.get(e);i.to({x:-o.stageHeight/3,scaleX:2,scaleY:2,rotation:90},250),i.to({x:-o.stageHeight+100,scaleX:1,scaleY:1,rotation:180},250),i.call(function(){e.parent&&e.parent.removeChild(e),t()})},o.addBoom=function(){var t=ObjectPool.pop(KingkongItem,"KingkongItem");t.type=KingkongItem.TYPE_FIRE_BOOM,t.x=0,o.master?t.y=o._kingkongOffsetY:t.y=o._kingkongOffsetY,o._itemContainer.addChild(t),o.addBoomComplete(t)},o.master=n,o.stageWidth=e,o.stageHeight=i,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAdded,o),o._building=new Building,o._kingkong=new Kingkong(n),o._itemContainer=new egret.DisplayObjectContainer,s?o._uiContainer=s:o._uiContainer=new egret.DisplayObjectContainer,o.btnJump=AssetManager.getDBArmature("tiaoyue"),o.btnShoot=AssetManager.getDBArmature("renglei"),o._tip=AssetManager.getDBArmature("tishi");var r=GameData.gameUser;if(o.master)r=GameData.gameUser;else{for(var a=0;a<GameData._playerList.length;a++)GameData._playerList[a].id!=GameData.gameUser.id&&(r=GameData._playerList[a]);r.curAvatarType=2}return o._avatar=new RoleAvatar(r.curAvatarType,r.avatar).armature,o._chain=AssetManager.getBitmap("chain_png"),o}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t,this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameStart",{get:function(){return this._gameStart},enumerable:!0,configurable:!0}),e.prototype.addTip=function(){var t=this;this._tip&&(this._tip.play("tishi2",0),this.tipFlag=setTimeout(function(){t.removeTip()},2e3),this._tip.x=this.btnJump.x,this._tip.y=this.btnJump.y,this._uiContainer.addChild(this._tip))},e.prototype.removeTip=function(){this._tip&&this._tip.parent&&(this._tip.stop(),this._tip.parent.removeChild(this._tip),clearTimeout(this.tipFlag),this.tipFlag=void 0)},e.prototype.onAdded=function(t){this.init()},e.prototype.dispose=function(){App.TimerManager.remove(this.advanceTime,this),this.removeAllItems(),this._itemContainer.removeChildren(),this.tipFlag&&clearTimeout(this.tipFlag)},e.prototype.init=function(){var t=RES.getRes("levelConfig_json").level[this._curLevel];this._curItemConfigs=t.concat(),this._building.rotation=90,this._building.x=0,this._building.y=this.stageHeight,this.addChild(this._building),this._building.stop(),this._avatar.rotation=90,this._avatar.x=this.stageWidth/2-250,this._avatar.y=this.stageHeight/2,this._avatar.scaleX=this._avatar.scaleY=.7,this.addChild(this._avatar),this._chain.x=this._avatar.x,this._chain.y=this._avatar.y,this._chain.scaleX=this._chain.scaleY=.7,this.addChild(this._chain),this._uiContainer.x=0,this._uiContainer.y=0,this.addChild(this._uiContainer),this.btnJump.x=this.btnShoot.x=.5*this.stageWidth,this.btnJump.y=this.btnShoot.y=.5*this.stageHeight,this.addChild(this._itemContainer),this._itemContainer.rotation=90,this._itemContainer.x=this.stageWidth-60,this._itemContainer.y=this.stageHeight-50,this._uiContainer.addChild(this.btnJump),this._uiContainer.addChild(this.btnShoot),this.master||(this.btnJump.visible=!1,this.btnShoot.visible=!1),this._kingkong.x=this._kingkongOffsetX,this._kingkong.y=this.stageHeight-this._kingkongOffsetY,this._kingkong.rotation=90,this._kingkongPosY=this.stageWidth-this._kingkong.x,this._kingkongPosMaxY=this._kingkongPosY+Kingkong.LEG_LENGTH+KingkongItem.HALF_SIZE,this._kingkongPosMinY=this._kingkongPosY-Kingkong.LEG_LENGTH-KingkongItem.HALF_SIZE,this.addChild(this._kingkong),this._kingkong.stand(),this._totalDistance=this.configToD(this._curItemConfigs[this._curItemConfigs.length-1].d)+this.stageWidth-320,console.log(this._totalDistance),this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3),this.master&&this.preStart(),App.TimerManager.doTimer(1,0,this.advanceTime,this)},e.prototype.initAI=function(t){this._mode==e.MODE_AI&&(null==this._ai&&(this._ai=new AIKingkong,this._ai.addEventListener(Kingkong.EVENT_SHOOT,this.onAIShoot,this),this._ai.addEventListener(Kingkong.EVENT_JUMP,this.onAIJump,this)),this._ai.level=t,this._ai.kingkong=this._kingkong,this._ai.curItems=this._curItems)},e.prototype.onAIShoot=function(t){this.touchLeft()},e.prototype.onAIJump=function(t){this.touchRight()},e.prototype.advanceTime=function(t){return this._gameStart&&(this._building.advanceTime(t),this._curTime+=t,this._curDistance=this._building.curDistance,this.addItems(),this.moveItems(),this.removeItems(),this.testHit(),this._fast&&this.checkFast(t),this.checkWin(),this.progress=this._curDistance/this._totalDistance,this._mode==e.MODE_AI&&this._ai.advanceTime(t),this._invincibleTime>0&&(this._invincibleTime-=t)),!0},e.prototype.checkWin=function(){this._curDistance>this._totalDistance&&this.win()},e.prototype.fail=function(){this._kingkong.getBoom(!1),this.btnShoot.play("renglei0",1),this.removeTip(),this.gameOver()},e.prototype.win=function(){var t=this;if(this.key){this.key.x+=this._kingkong.x,this.key.y+=this._kingkong.y,this._uiContainer.addChild(this.key);var e=egret.Tween.get(this.key),i=this._avatar.x-this.key.x,n=this._avatar.y-this.key.y;e.to({x:this.key.x+i/2,y:this.key.y+n/2,scaleX:2,scaleY:2},1e3),e.to({x:this.key.x+i,y:this.key.y+n,scaleX:1,scaleY:1},1e3),e.call(function(){t._avatar.play("win"),t._chain.alpha=0,t.key.x=0,t.removeItem(t.key,0),t.key=null}),e.call(function(){t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_OVER))})}this._kingkong.getBoom(!1),this.btnShoot.play("renglei0",1),this.removeTip(),this.dispatchEvent(new egret.Event(Kingkong.EVENT_WIN)),this.gameOver()},e.prototype.gameOver=function(){this._curDistance=0,this._fastLastTime=0,this._building.curDistance=0,this._curTime=0,this._gameStart=!1,this._building.stop(),this._kingkong.stand(),this.removeTip(),this._mode==e.MODE_AI&&this._ai.over(),this.tipFlag&&clearTimeout(this.tipFlag)},e.prototype.checkFast=function(t){this._fastLastTime>0?this._fastLastTime-=t:this.stopFast()},e.prototype.testHit=function(){var t,i,n,s,o;for(t=0,i=this._curItems.length;i>t;t++){if(this._curItems[t].type===KingkongItem.TYPE_WIN)return;if(!(this._curItems[t].type!=KingkongItem.TYPE_KEY&&this._curItems[t].y>this._kingkongPosMinY))break;if(this._curItems[t].y<this._kingkongPosMaxY&&!this._kingkong.onAir()&&!this._kingkong.invincible){o=this._curItems[t],n=!0,s=this._curItems[t].type,this.removeItem(o,t);break}}if(n&&this.mode!=e.MODE_NET)switch(s){case KingkongItem.TYPE_BANANA:this.kingkongGetBanana();break;case KingkongItem.TYPE_BOOM:this.kingkongGetBoom();break;case KingkongItem.TYPE_FIRE_BOOM:this._invincibleTime<=0&&(this.kingkongHit(),this._invincibleTime=e.INVINCIBLE_TIME)}},e.prototype.stopFast=function(){this._fast=!1,this._building.runNormal(),this._kingkong.runNormal()},e.prototype.kingkongGetBanana=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BANANA,!1,!1,this._curDistance)),this._fast=!0,this._slow=!1,App.SoundManager.playEffect("banana_mp3",!0),this._fastLastTime=e.FAST_TIME,this._building.runFast(),this._kingkong.runFast(),this._avatar.play("chi",1)},e.prototype.kingkongGetBoom=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BOOM,!1,!1,this._curDistance)),this._kingkong.getBoom(!0),this.btnShoot.play("renglei1",1),this.master&&!this.tipFlag&&this.addTip()},e.prototype.kingkongRecover=function(){this._slow=!1,this._fast=!1,this._building.runNormal(),this._kingkong.runNormal(),this._kingkong.removeEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this)
},e.prototype.onKingkongRecover=function(t){this.kingkongRecover()},e.prototype.kingkongHit=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_BOOM,!1,!1,this._curDistance)),this._slow=!0,this._fast=!1,this._building.runSlow(),this._kingkong.runSlow(),this._kingkong.getBoom(!1),this.removeTip(),App.SoundManager.playEffect("kingkongBoom_mp3",!0),this.btnShoot.play("renglei0",1),this._kingkong.addEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this),this._kingkong.playHit(),this._avatar.play("zha",1)},e.prototype.disToConfig=function(t){return(this._curDistance-t)/100},e.prototype.configToD=function(t){return 100*t},e.prototype.addBoomComplete=function(t){t.pos=this.disToConfig(t.y),this.master||this.dispatchEvent(new egret.Event(e.EVENT_SHOOT_GROUND,!1,!1,t.pos)),this._lastAddedBoom=t;var i,n,s;for(i=0,n=this._curItems.length;n>i;i++)if(this._curItems[i].pos>t.pos){this._curItems.splice(i,0,t),s=!0;break}s||this._curItems.push(t)},e.prototype.addItems=function(){if(this._curItemConfigs.length>0)for(var t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t);i<this._curDistance;){this._curItemConfigs.shift();var n=ObjectPool.pop(KingkongItem,"KingkongItem");if(n.x=0,n.type=e,n.pos=t,n.type==KingkongItem.TYPE_KEY&&(this.key=n),this._itemContainer.addChild(n),this._curItems.push(n),!(this._curItemConfigs.length>0)){i=Number.MAX_VALUE;break}t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t)}},e.prototype.moveItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y=this._curDistance-this.configToD(i.pos)},e.prototype.removeItem=function(t,e){ObjectPool.push(t),this._curItems.splice(e,1),t.parent&&t.parent.removeChild(t)},e.prototype.removeItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y>this.stageWidth&&i.type!=KingkongItem.TYPE_KEY&&(ObjectPool.push(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i))},e.prototype.removeAllItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],ObjectPool.push(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i)},e.prototype.touchLeft=function(){this._kingkong.hasBoom&&this.kingkongShoot()},e.prototype.touchRight=function(){this._kingkong.jumpEnable()&&this.kingkongJump()},e.prototype.kingkongJump=function(){console.log(this.master),this.master&&this.dispatchEvent(new egret.Event(e.EVENT_JUMP,!1,!1,this._curDistance)),this._kingkong.jump(),App.SoundManager.playEffect("kingkongjump_mp3",!0),this.btnJump.play("tiaoyue",1),e.touched=!0},e.prototype.kingkongShoot=function(){var t=this,i=this;this.master&&i.dispatchEvent(new egret.Event(e.EVENT_SHOOT,!1,!1,this._curDistance));var n=function(){t.btnShoot.removeDisplayEvent(dragonBones.EventObject.COMPLETE,n,t),t.btnShoot.play("renglei0",1)};this.btnShoot.addDisplayEvent(dragonBones.EventObject.COMPLETE,n,this),this.btnShoot.play("renglei2",1),this._kingkong.getBoom(!1),this.removeTip(),this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),e.touched=!0},e.prototype.preStart=function(){var t=this,e=new GameReady(function(){t.startRun(),t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_START))});e.x=App.GameWidth/2,e.y=App.GameHeight/2,this.addChild(e),e.play()},e.prototype.startRun=function(){this._gameStart=!0,this._curTime=0,this.progress=0,this._building.reset(),this._kingkong.reset(),this._invincibleTime=0,this._curDistance=0,this._avatar&&this._avatar.play("newAnimation"),this._building.run(),this._kingkong.run(),this._mode==e.MODE_AI&&this._ai.start()},e.EVENT_SHOOT="kingkongScene:EVENT_SHOOT",e.EVENT_SHOOT_GROUND="kingkongScene:EVENT_SHOOT_GROUND",e.EVENT_JUMP="kingkongScene:EVENT_JUMP",e.EVENT_BOOM="kingkongScene:EVENT_BOOM",e.EVENT_GET_BOOM="kingkongScene:EVENT_GET_BOOM",e.EVENT_GET_BANANA="kingkongScene:EVENT_GET_BANANA",e.MODE_MANUAL=0,e.MODE_NET=1,e.MODE_AI=2,e.FAST_TIME=3e3,e.INVINCIBLE_TIME=1.1,e}(egret.DisplayObjectContainer);__reflect(KingkongScene.prototype,"KingkongScene");var GameSceneView=function(t){function e(){var i=t.call(this)||this;return e._gameScene=i,i.initView(),i}return __extends(e,t),e.prototype.errorResponse=function(t,i){console.log("错误回调：errCode="+t+" errMsg="+i),e._gameScene.errorView(0,"错误回调：errCode="+t+" errMsg="+i)},e.prototype.errorResponses=function(t){mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_ERROR_RSP,this.errorResponse,this);var i=t.data.errCode,n=t.data.errMsg;1001==i&&(""!=n&&n.indexOf("hotel")>=0?e._gameScene.errorView(1,"错误回调：errCode="+i+" errMsg="+n):e._gameScene.errorView(0,"错误回调：errCode="+i+" errMsg="+n))},e.prototype.initView=function(){mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_ERROR_RSP,this.errorResponses,this),this.thisContainer=new egret.Sprite,this.addChild(this.thisContainer),this.login()},e.prototype.login=function(){this.removeAll();var t=new Login;this.cuntPage=t,this.thisContainer.addChild(t)},e.prototype.lobby=function(){this.removeAll();var t=new Lobby;Lobby.canClick=!0,this.cuntPage=t,this.thisContainer.addChild(t)},e.prototype.match=function(t){this.removeAll();var e=new match(t);match.canClick=!0,this.cuntPage=e,this.thisContainer.addChild(e),console.log(11111),console.log(this.thisContainer)},e.prototype.gameResult=function(t){GameResultView.canClick=!0;var e=new GameResultView(t);this.cuntPage=e,this.thisContainer.addChild(e)},e.prototype.play=function(){this.removeAll(),GameKingkong.canClick=!0;var t=new GameKingkong;this.cuntPage=t,this.thisContainer.addChild(t)},e.prototype.reconnectView=function(){this.removeAll();var t=new ReconnectUI;this.thisContainer.addChild(t)},e.prototype.errorView=function(t,e){this.removeAll(),GameData.init();var i=new ErrorNote;i.SetErrorMsg(e),this.thisContainer.addChild(i)},e.prototype.removeAll=function(){this.cuntPage&&this.cuntPage.release&&(console.log("释放"),this.cuntPage.release(),this.cuntPage=null),this.thisContainer.removeChildren()},e}(egret.Sprite);__reflect(GameSceneView.prototype,"GameSceneView");var AIKingkong=function(t){function e(){var e=t.call(this)||this;return e.level=0,e._nextRandomJumpTime=3,e._nextJumpTime=0,e._nextShootTime=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"kingkong",{set:function(t){this._kingkong=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curItems",{set:function(t){this._curItems=t},enumerable:!0,configurable:!0}),e.prototype.start=function(){this._kingkong&&this._curItems&&(this._running=!0)},e.prototype.over=function(){this._running=!1},e.prototype.advanceTime=function(t){this._running&&(this._kingkong.hasBoom&&(this._nextShootTime-=t,this._nextShootTime<0&&(this.kingkongCanShoot()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),this.resetNextShootTime())),this._kingkong.jumpEnable()&&(this.kingkongCanJump(t)?this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP)):(this._nextRandomJumpTime-=t,this._nextRandomJumpTime<0&&(this._nextRandomJumpTime=Math.random()*e.RANDOM_JUMP_TIME,this.randomJump()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP))))))},e.prototype.resetNextShootTime=function(){switch(this.level){case e.AI_LEVEL_0:this._nextShootTime=1*Math.random()+1;break;case e.AI_LEVEL_1:this._nextShootTime=.5*Math.random()+.5;break;case e.AI_LEVEL_2:this._nextShootTime=.5*Math.random()+.2;break;case e.AI_LEVEL_3:this._nextShootTime=.2*Math.random();break;default:this._nextShootTime=1}},e.prototype.kingkongCanShoot=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(.2>t)return!0;break;case e.AI_LEVEL_1:if(.4>t)return!0;break;case e.AI_LEVEL_2:if(.8>t)return!0;break;case e.AI_LEVEL_3:if(1.2>t)return!0;break;default:return!0}return!1},e.prototype.kingkongCanJump=function(t){if(this._curItems&&this._curItems.length>0){var i=this._curItems[0].y-this._kingkong.y;if(i>e.MIN_JUMP_DIS&&i<e.MAX_JUMP_DIS&&(this._nextJumpTime-=t,this._nextJumpTime<0)){var n=Math.random();switch(this.level){case e.AI_LEVEL_0:if(this._nextJumpTime=.1*Math.random()+.3,.2>n)return!0;break;case e.AI_LEVEL_1:if(this._nextJumpTime=.1*Math.random()+.2,.5>n)return!0;break;case e.AI_LEVEL_2:if(this._nextJumpTime=.1*Math.random()+.1,.8>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;case e.AI_LEVEL_3:if(1.2>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;default:return!0}}}return!1},e.prototype.randomJump=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(t>.2)return!1;break;case e.AI_LEVEL_1:if(.4>t)return!1;break;case e.AI_LEVEL_2:if(.8>t)return!1;break;case e.AI_LEVEL_3:if(1.2>t)return!1;break;default:return!1}return!0},e.AI_LEVEL_0=0,e.AI_LEVEL_1=1,e.AI_LEVEL_2=2,e.AI_LEVEL_3=3,e.MAX_JUMP_DIS=520,e.MIN_JUMP_DIS=450,e.RANDOM_JUMP_TIME=3,e}(egret.EventDispatcher);__reflect(AIKingkong.prototype,"AIKingkong");var Building=function(t){function e(){var e=t.call(this)||this;e._offset=1195;var i="ground";return e.dbBuilding=AssetManager.getDBArmature(i),e._bone=e.dbBuilding.getBone("bone"),e.addChild(e.dbBuilding),e.stop(),e.reset(),e}return __extends(e,t),e.prototype.reset=function(){this._curD=this._bone.globalTransformMatrix.ty,this._lastD=this._curD,this.tickDistance=0,this.curDistance=0},e.prototype.advanceTime=function(t){for(this._curD=this._bone.globalTransformMatrix.ty,this.tickDistance=this._curD-this._lastD;this.tickDistance<0;)this.tickDistance+=this._offset;this._lastD=this._curD,this.curDistance+=this.tickDistance},e.prototype.runNormal=function(){var t=egret.Tween.get(this.dbBuilding);t.to({timeScale:e.NORMAL_SPEED},500)},e.prototype.runFast=function(){var t=egret.Tween.get(this.dbBuilding);t.to({timeScale:e.FAST_SPEED},500)},e.prototype.runSlow=function(){this.dbBuilding.timeScale=0},e.prototype.run=function(){this.dbBuilding.play("run"),this.runSlow(),this.runNormal(),this.reset()},e.prototype.stop=function(){this.dbBuilding.stop()},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Building.prototype,"Building");var Kingkong=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this,n=e?"kingkong":"kingkongBlue";i.dbKingkong=AssetManager.getDBArmature(n),i.dbKingkong.scaleX=i.dbKingkong.scaleY=1.5,i._dust=AssetManager.getDBArmature("dust"),i._dust&&(i._dust.timeScale=1.5),i._bananaPeel=AssetManager.getDBArmature("bananaPeel"),i._bananaPeel.timeScale=1.5,i._bananaPeel.gotoAndStop("run"),i.addChild(i.dbKingkong);var s=i.dbKingkong.getSlot("boom");return s&&(i.boomArmature=s.childArmature),i.dbKingkong.replaceSlot("dust",i._dust),i.dbKingkong.replaceSlot("bananaPeel",i._bananaPeel),i}return __extends(e,t),e.prototype.onAir=function(){return this._status==e.STATUS_JUMP&&this._jumpState&&this._jumpState.currentTime>.17&&this._jumpState.currentTime<1.5?!0:!1},e.prototype.run=function(){this.invincible=!1,this._status=e.STATUS_RUN,this.dbKingkong.timeScale=e.NORMAL_SPEED,this._fast?(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.FAST_SPEED},500)):this._slow?this.dbKingkong.timeScale=e.SLOW_SPEED:this.dbKingkong.timeScale=e.NORMAL_SPEED,this.dbKingkong.play("run",0)},e.prototype.playHit=function(){this._speedTw&&egret.Tween.removeTweens(this.dbKingkong),this.invincible=!0,this._fast=!1,this._status=e.STATUS_HIT,this.dbKingkong.timeScale=e.NORMAL_SPEED,this.dbKingkong.play("boom",1),this.dbKingkong.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.onBoomComplete=function(t){this.dispatchEvent(new egret.Event(e.EVENT_RECOVER)),this.run(),this.dbKingkong.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.jumpEnable=function(){return this._status==e.STATUS_RUN},e.prototype.jump=function(){this._speedTw&&egret.Tween.removeTweens(this.dbKingkong),this.invincible=!1,this._status=e.STATUS_JUMP,this.dbKingkong.timeScale=e.NORMAL_SPEED,this._jumpState=this.dbKingkong.play("jump",1),this.dbKingkong.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this);var t=Math.floor(7*Math.random())+1;this._dust.play("boom"+t,1)},e.prototype.runFast=function(){this._fast=!0,this._slow=!1,this._bananaPeel&&this._bananaPeel.play("run",1),this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.FAST_SPEED},500))},e.prototype.runSlow=function(){this._slow=!0,this._fast=!1,this._status==e.STATUS_RUN&&(this.dbKingkong.timeScale=e.SLOW_SPEED)},e.prototype.runNormal=function(){this._fast=!1,this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.dbKingkong),this._speedTw.to({timeScale:e.NORMAL_SPEED},500),this.dbKingkong.timeScale=e.NORMAL_SPEED)},e.prototype.onJumpComplete=function(t){this._fast?this.dbKingkong.timeScale=e.FAST_SPEED:this._slow?this.dbKingkong.timeScale=e.SLOW_SPEED:this.dbKingkong.timeScale=e.NORMAL_SPEED,this.run(),this.dbKingkong.removeDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this)},e.prototype.stand=function(){this.invincible=!0,this._status=e.STATUS_STAND,this.dbKingkong.gotoAndStop("stand")},e.prototype.getBoom=function(t){if(this.hasBoom=t,this.boomArmature){var e=this.hasBoom?"boom1":"boom0";this.boomArmature.animation.gotoAndStop(e)}},e.prototype.reset=function(){this._fast=!1,this._slow=!1,this.invincible=!1},e.EVENT_RECOVER="EVENT_RECOVER",e.EVENT_SHOOT="EVENT_SHOOT",e.EVENT_JUMP="EVENT_JUMP",e.EVENT_WIN="EVENT_WIN",e.EVENT_GAME_START="EVENT_GAME_START",e.EVENT_GAME_OVER="EVENT_GAME_OVER",e.STATUS_RUN=0,e.STATUS_JUMP=1,e.STATUS_HIT=2,e.STATUS_STAND=3,e.STATUS_OVER=4,e.ARM_LENGTH=84,e.LEG_LENGTH=60,e.LENGTH=e.ARM_LENGTH+e.LEG_LENGTH,e.NORMAL_SPEED=2,e.FAST_SPEED=3,e.SLOW_SPEED=1,e}(egret.Sprite);__reflect(Kingkong.prototype,"Kingkong");var KingkongItem=function(t){function e(){var e=t.call(this)||this,i="kingkongItem";return e._item=AssetManager.getQuickDBArmature(i),e._item.scaleX=e._item.scaleY=1.2,e.addChild(e._item),e}return __extends(e,t),e.prototype.reDraw=function(){var t=16711680;switch(this._item.stop(),this._type){case e.TYPE_BANANA:t=16776960,this._item.gotoAndStop("banana");break;case e.TYPE_BOOM:t=0,this._item.gotoAndStop("boom");break;case e.TYPE_FIRE_BOOM:t=16711680,this._item.play("fireBoom");break;case e.TYPE_KEY:t=16711680,this._item.gotoAndStop("key");break;case e.TYPE_WIN:t=16711680,this._item.gotoAndStop("qi");break;default:t=16777215,this._item.stop()}},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.reDraw()},enumerable:!0,configurable:!0}),e.TYPE_BANANA=0,e.TYPE_BOOM=1,e.TYPE_FIRE_BOOM=2,e.TYPE_KEY=3,e.TYPE_WIN=4,e.SIZE=75,e.HALF_SIZE=e.SIZE/2,e}(egret.Sprite);__reflect(KingkongItem.prototype,"KingkongItem");var ScoreData=function(){function t(){this._curBestHit=0,this._curGoodHit=0,this._curMissHit=0,this._curComboo=0,this.maxBestHit=0,this.maxGoodHit=0,this.maxMissHit=0,this.maxComboo=0}return Object.defineProperty(t.prototype,"curBestHit",{get:function(){return this._curBestHit},set:function(t){this._curBestHit=t,this.maxBestHit<this._curBestHit&&(this.maxBestHit=this._curBestHit),this.curComboo++,console.log("cur best:",this._curBestHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curGoodHit",{get:function(){return this._curGoodHit},set:function(t){this._curGoodHit=t,this.maxGoodHit<this._curGoodHit&&(this.maxGoodHit=this._curGoodHit),this.curComboo++,console.log("cur good:",this._curGoodHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curMissHit",{get:function(){return this._curMissHit},set:function(t){this._curMissHit=t,this.maxMissHit<this._curMissHit&&(this.maxMissHit=this._curMissHit),this._curComboo=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curComboo",{get:function(){return this._curComboo},set:function(t){this._curComboo=t,this.maxComboo<this._curComboo&&(this.maxComboo=this._curComboo),console.log("cur comboo:",this._curComboo)},enumerable:!0,configurable:!0}),t}();__reflect(ScoreData.prototype,"ScoreData");var mvs;!function(t){var e=function(){function e(){this._engine=null,this._response=null,this._engine=new MatchvsEngine}return Object.defineProperty(e,"getInstance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(e,i,n){this._response=t.MsResponse.getInstance.getResponse();var s=this._engine.init(t.MsResponse.getInstance.getResponse(),e,i,n);return console.log("))))))))))))))))))"+s),0!==s?(console.info("[MsEngine init failed] resCode:",s),s):(console.info("[MsEngine init seccess] resCode:",s),s)},e.prototype.setRegisterHost=function(t){var e=this._engine.setRegisterHost(t);return console.log(e+"||||||||||||||||||||||||||||||"),e},e.prototype.premiseInit=function(e,i){this._response=t.MsResponse.getInstance.getResponse();var n=this._engine.premiseInit(t.MsResponse.getInstance.getResponse(),e,i);return 0!==n?(console.info("[MsEngine premiseInit failed] resCode:",n),n):(console.info("[MsEngine premiseInit seccess] resCode:",n),n)},e.prototype.login=function(t,e,i,n,s){var o=this._engine.login(t,e,i,1,n,s,"eglejjddg",0);return console.info("[MsEngine login] resCode:",o),o},e.prototype.registerUser=function(){var t=this._engine.registerUser();return console.log("**************************"+t),0!==t?(console.error("[MsEngine registerUser failed] resCode:",t),t):(console.info("[MsEngine registerUser seccess] resCode:",t),t)},e.prototype.joinRandomRoom=function(t,e){var i=this._engine.joinRandomRoom(t,e);return console.info("[MsEngine joinRandomRoom ] resCode:",i),i},e.prototype.joinRoomWithProperties=function(t,e){var i=this._engine.joinRoomWithProperties(t,e);return console.info("[MsEngine joinRandomRoom ] resCode:",i),i},e.prototype.joinRoom=function(t,e){var i=this._engine.joinRoom(t,e);return i},e.prototype.createRoom=function(t,e){var i=this._engine.createRoom(t,e);return console.info("[MsEngine createRoom ] resCode:",i,JSON.stringify(t),e),i},e.prototype.joinOver=function(t){var e=this._engine.joinOver(t);return console.info("[MsEngine joinOver ] resCode:",e),e},e.prototype.joinOpen=function(t){var e=this._engine.joinOpen(t);return console.info("[MsEngine joinOpen ] resCode:",e),e},e.prototype.leaveRoom=function(t){var e=this._engine.leaveRoom(t);return console.info("[MsEngine leaveRoom ] resCode:",e),e},e.prototype.sendEvent=function(t){var e=this._engine.sendEvent(t);return e},e.prototype.sendEventEx=function(t,e,i,n){var s=this._engine.sendEventEx(t,e,i,n);return s},e.prototype.sendFrameEvent=function(t){var e=this._engine.sendFrameEvent(t);return console.info("[MsEngine sendFrameEvent ] resCode:",e),e},e.prototype.setFrameSync=function(t){var e=this._engine.setFrameSync(t);return console.info("[MsEngine setFrameSync ] resCode:",e),e},e.prototype.logOut=function(){var t=this._engine.logout("退出登录");return console.info("[MsEngine setFrameSync ] resCode:",t),t},e.prototype.kickPlayer=function(t,e){var i=this._engine.kickPlayer(t,e);return console.info("[MsEngine kickPlayer ] resCode:",i),i},e.prototype.getRoomDetail=function(t){var e=this._engine.getRoomDetail(t);return console.info("[MsEngine getRoomDetail ] resCode:",e),e},e.prototype.getRoomList=function(t){var e=this._engine.getRoomList(t);return console.info("[MsEngine getRoomList ] resCode:",e),e},e.prototype.getRoomListEx=function(t){var e=this._engine.getRoomListEx(t);return console.info("[MsEngine getRoomListEx ] resCode:",e),e},e.prototype.setRoomProperty=function(t,e){var i=this._engine.setRoomProperty(t,e);return console.info("[MsEngine setRoomProperty ] resCode:",i),i},e.prototype.reconnect=function(){var t=this._engine.reconnect();return console.info("[MsEngine reconnect ]",t),t},e._instance=null,e}();t.MsEngine=e,__reflect(e.prototype,"mvs.MsEngine")}(mvs||(mvs={}));var mvs;!function(t){var e=function(){function t(){}return t.EVENT_INIT_RSP="MATCHVS_INIT_EVENT",t.EVENT_REGISTERUSER_RSP="MATCHVS_REGISTERUSER_EVENT",t.EVENT_LOGIN_RSP="MATCHVS_LOGIN_EVENT",t.EVENT_JOINROOM_RSP="MATCHVS_JOINROOM_EVENT",t.EVENT_JOINROOM_NTFY="MATCHVS_JOINROOM_NOTIFY_EVENT",t.EVENT_CREATEROOM_RSP="MATCHVS_CREATEROOM_RSP_EVENT",t.EVENT_SENDEVENT_RSP="MATCHVS_SENDEVENT_RSP_EVENT",t.EVENT_SENDEVENT_NTFY="MATCHVS_SENDEVENT_NOTIFY_EVENT",t.EVENT_SENDEVENT_CHUANG="MATCHVS_SENDEVENT_RSP_EVENT_chuang",t.EVENT_GAMESERVER_NTFY="MATCHVS_GAMESERVER_NOTIFY_EVENT",t.EVENT_LEAVEROOM_RSP="MATCHVS_LEAVEROOM_RSP_EVENT",t.EVENT_LEAVEROOM_NTFY="MATCHVS_LEAVEROOM_NTFY_EVENT",t.EVENT_JOINOVER_RSP="MATCHVS_JOINOVER_RSP_EVENT",t.EVENT_JOINOVER_NTFY="MATCHVS_LEAVEROOM_EVENT",t.EVENT_JOINOPEN_RSP="MATCHVS_JOINOPEN_RSP_EVENT",t.EVENT_JOINOPEN_NTFY="MATCHVS_JOINOPEN_NTFY_EVENT",t.EVENT_NETWORKSTATE_NTFY="MATCHVS_NETWORKSTATE_NTFY",t.EVENT_SENDFRAME_RSP="MATCHVS_SENDFRAME_RSP_EVENT",t.EVENT_SETFRAMESYNC_RSP="MATCHVS_SETFRAMESYNC_RSP_EVENT",t.EVENT_FRAMEUPDATE="MATCHVS_FRAMEUPDATE_EVENT",t.EVENT_ERROR_RSP="MATCHVS_ERROR_RSP_EVENT",t.EVENT_LOGOUT_RSP="MATCHVS_LOGOUT_RSP_EVENT",t.EVENT_SETROOMPROPERTY_RSP="MATCHVS_SETROOMPROPERTY_RSP_EVENT",t.EVENT_SETROOMPROPERTY_NTFY="MATCHVS_SETROOMPROPERTY_NTFY_EVENT",t.EVENT_KICKPLAYER_RSP="MATCHVS_KICKPLAYER_RSP_EVENT",t.EVENT_KICKPLAYER_NTFY="MATCHVS_KICKPLAYER_NTFY_EVENT",t.EVENT_GETROOMLIST_RSP="MATCHVS_GETROOMLIST_RSP_EVENT",t.EVENT_GETROOMLIST_EX_RSP="MATCHVS_GETROOMLIST_EX_RSP_EVENT",t.EVENT_GETROOMDETAIL_RSP="MATCHVS_GETROOMDETAIL_RSP_EVENT",t.EVENT_RECONNECT_RSP="MATCHVS_RECONNECT_RSP_EVENT",t}();t.MsEvent=e,__reflect(e.prototype,"mvs.MsEvent")}(mvs||(mvs={}));var mvs;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.reframe=[],t.startTime=0,t.endTime=0,t.frist=0,t.re100=0,t.re70=0,t.re200=0,t.re60=0,t.re40=0,t._response=null,t.registResponseCall(),t}return __extends(i,e),Object.defineProperty(i,"getInstance",{get:function(){return null==i._instance&&(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.release=function(){i._instance._response=null,i._instance=null},i.prototype.getResponse=function(){return null==this._response&&this.registResponseCall(),this._response},i.prototype.registResponseCall=function(){this._response=new MatchvsResponse,this._response.initResponse=this.initResponse.bind(this),this._response.registerUserResponse=this.registerUserResponse.bind(this),this._response.loginResponse=this.loginResponse.bind(this),this._response.joinRoomResponse=this.joinRoomResponse.bind(this),this._response.joinRoomNotify=this.joinRoomNotify.bind(this),this._response.createRoomResponse=this.createRoomResponse.bind(this),this._response.sendEventResponse=this.sendEventResponse.bind(this),this._response.sendEventNotify=this.sendEventNotify.bind(this),this._response.gameServerNotify=this.gameServerNotify.bind(this),this._response.joinOverResponse=this.joinOverResponse.bind(this),this._response.joinOverNotify=this.joinOverNotify.bind(this),this._response.leaveRoomResponse=this.leaveRoomResponse.bind(this),this._response.leaveRoomNotify=this.leaveRoomNotify.bind(this),this._response.networkStateNotify=this.networkStateNotify.bind(this),this._response.setFrameSyncResponse=this.setFrameSyncResponse.bind(this),this._response.frameUpdate=this.frameUpdate.bind(this),this._response.errorResponse=this.errorResponse.bind(this),this._response.logoutResponse=this.logOutResponse.bind(this),this._response.joinOpenResponse=this.joinOpenResponse.bind(this),this._response.joinOpenNotify=this.joinOpenNotify.bind(this),this._response.kickPlayerNotify=this.kickPlayerNotify.bind(this),this._response.kickPlayerResponse=this.kickPlayerResponse.bind(this),this._response.setRoomPropertyNotify=this.setRoomPropertyNotify.bind(this),this._response.setRoomPropertyResponse=this.setRoomPropertyResponse.bind(this),this._response.getRoomDetailResponse=this.getRoomDetailResponse.bind(this),this._response.getRoomListExResponse=this.getRoomListExResponse.bind(this),this._response.getRoomListResponse=this.getRoomListResponse.bind(this),this._response.reconnectResponse=this.reconnectResponse.bind(this)},i.prototype.initResponse=function(e){console.info("initResponse status：",e),this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_INIT_RSP,!1,!1,{status:e}))},i.prototype.registerUserResponse=function(e){console.info("registerUserResponse userInfo ",JSON.stringify(e)),this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_REGISTERUSER_RSP,!1,!1,e))},i.prototype.loginResponse=function(e){console.info("[loginResponse] "+JSON.stringify(e)),this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_LOGIN_RSP,!1,!1,e))},i.prototype.joinRoomResponse=function(e,i,n){if(200==e){var s={status:e,userList:i,roomInfo:n};return void this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINROOM_RSP,!1,!1,s))}409==e&&GameSceneView._gameScene.lobby(),console.error("[joinRoomResponse error:]",e)},i.prototype.joinRoomNotify=function(e){console.info("[joinRoomNotify] "+e.userProfile);var i={userId:e.userId,userProfile:e.userProfile};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINROOM_NTFY,!1,!1,i))},i.prototype.createRoomResponse=function(e){console.info("[sendEventResponse]"+JSON.stringify(e));var i={status:e.status,roomID:e.roomID,owner:e.owner};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_CREATEROOM_RSP,!1,!1,i))},i.prototype.sendEventResponse=function(e){var i={status:e.status,sequence:e.sequence};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_SENDEVENT_RSP,!1,!1,i))},i.prototype.sendEventNotify=function(e){var i={srcUserId:e.srcUserId,cpProto:e.cpProto};console.log("+++++++++++++++++++++++++发送消息派发+++++++++++++++++++++++++++++++++"),this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_SENDEVENT_NTFY,!1,!1,i))},i.prototype.gameServerNotify=function(e){console.info("[gameServerNotify] ");var i={srcUserId:e.srcUserId,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_GAMESERVER_NTFY,!1,!1,i))},i.prototype.joinOverResponse=function(e){console.info("[joinOverResponse] "+JSON.stringify(e));var i={status:e.status,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINOVER_RSP,!1,!1,i))},i.prototype.joinOverNotify=function(e){console.info("[joinOverNotify] ");var i={roomID:e.roomID,userID:e.srcUserID,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINOVER_NTFY,!1,!1,i))},i.prototype.leaveRoomResponse=function(e){console.info("[leaveRoomResponse] status: "+e.status);var i={roomID:e.roomID,status:e.status,userId:e.userId,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_LEAVEROOM_RSP,!1,!1,i))},i.prototype.leaveRoomNotify=function(e){console.info("[leaveRoomNotify] "+e.userId);var i={roomID:e.roomID,userId:e.userId,owner:e.owner,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_LEAVEROOM_NTFY,!1,!1,i))},i.prototype.networkStateNotify=function(e){console.info("[networkStateNotify] state: "+e.state);var i={roomID:e.roomID,userID:e.userID,owner:e.owner,state:e.state};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_NETWORKSTATE_NTFY,!1,!1,i))},i.prototype.setFrameSyncResponse=function(e){var i={mStatus:e.mStatus};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_SETFRAMESYNC_RSP,!1,!1,i))},i.prototype.frameUpdate=function(e){var i={frameIndex:e.frameIndex,frameItems:e.frameItems,frameWaitCount:e.frameWaitCount};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_FRAMEUPDATE,!1,!1,i))},i.prototype.errorResponse=function(e,i){console.info("[setFrameSyncResponse] errCode:"+e+" errMsg:"+i);var n={errCode:e,errMsg:i};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_ERROR_RSP,!1,!1,n))},i.prototype.logOutResponse=function(e){console.info("[logOutResponse] status:",e);var i={status:e};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_LOGOUT_RSP,!1,!1,i))},i.prototype.joinOpenResponse=function(e){console.info("[joinOpenResponse] info:",e.status);var i={status:e.status,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINOPEN_RSP,!1,!1,i))},i.prototype.joinOpenNotify=function(e){console.info("[joinOpenResponse] info:");var i={roomID:e.roomID,userID:e.userID,cpProto:e.cpProto};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_JOINOPEN_NTFY,!1,!1,i))},i.prototype.kickPlayerNotify=function(e){console.info("[kickPlayerNotify] info:");var i={cpProto:e.cpProto,owner:e.owner,srcUserId:e.srcUserId,userID:e.userID};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_KICKPLAYER_NTFY,!1,!1,i))},i.prototype.kickPlayerResponse=function(e){console.info("[kickPlayerResponse] info:"+e.status);var i={owner:e.owner,userID:e.userID,status:e.status};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_KICKPLAYER_RSP,!1,!1,i))},i.prototype.setRoomPropertyNotify=function(e){console.info("[setRoomPropertyNotify] info:");var i={roomID:e.roomID,userID:e.userID,roomProperty:e.roomProperty};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_SETROOMPROPERTY_NTFY,!1,!1,i))},i.prototype.setRoomPropertyResponse=function(e){console.info("[setRoomPropertyResponse] info:",e.status);var i={roomID:e.roomID,userID:e.userID,roomProperty:e.roomProperty,status:e.status};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_SETROOMPROPERTY_RSP,!1,!1,i))},i.prototype.getRoomDetailResponse=function(e){console.info("[getRoomDetailResponse] info:",e.status);var i={canWatch:e.canWatch,createFlag:e.createFlag,maxPlayer:e.maxPlayer,mode:e.mode,owner:e.owner,roomProperty:e.roomProperty,state:e.state,status:e.status,userInfos:e.userInfos};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_GETROOMDETAIL_RSP,!1,!1,i))},i.prototype.getRoomListExResponse=function(e){console.info("[getRoomListExResponse] info:",e.status);var i={roomAttrs:e.roomAttrs,status:e.status,total:e.total};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_GETROOMLIST_EX_RSP,!1,!1,i))},i.prototype.getRoomListResponse=function(e,i){console.info("[getRoomListResponse] info:",e);var n={status:e,roomInfos:i};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_GETROOMLIST_RSP,!1,!1,n))},i.prototype.reconnectResponse=function(e,i,n){console.info("[reconnectResponse] info:",e);var s={status:e,roomUserInfoList:i,roomInfo:n};this.dispatchEvent(new egret.Event(t.MsEvent.EVENT_RECONNECT_RSP,!1,!1,s))},i.prototype.frameUpdatequality=function(){var t=(new Date).valueOf();if(0==this.startTime?(this.startTime=t,this.frist=t):this.endTime=t,this.endTime-this.startTime>=5e5){for(var e=0,i=0;i<this.reframe.length;i++)e+=this.reframe[i];console.log("收到总次数：",this.reframe.length),console.log("发送间隔时间：",40),console.log("设置的帧率：",GameData.frameRate),console.log("总耗时：",this.endTime-this.startTime),console.log("预计收到间隔时间：",1e3/GameData.frameRate),console.log("平均收到间隔时间：",e/this.reframe.length),console.log("正常次数：",this.re60),console.log("小于 40 次数：",this.re40),console.log("60 ~ 100 次数：",this.re70),console.log("100 ~ 200 次数：",this.re100),console.log("大于 200 次数：",this.re200)}else{var n=t-this.frist;console.log("收到帧间隔时间：",n),0!==this.frist&&this.reframe.push(n),n>=40&&60>=n?this.re60++:40>n?this.re40++:n>60&&100>n?this.re70++:n>100&&200>n?this.re100++:n>200&&this.re200++}this.frist=t},i._instance=null,i}(egret.EventDispatcher);t.MsResponse=e,__reflect(e.prototype,"mvs.MsResponse")}(mvs||(mvs={}));var qr;!function(t){var e=function(){function e(e){this.mode=t.QRMode.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var i=0,n=this.data.length;n>i;i++){var s=[],o=this.data.charCodeAt(i);o>65536?(s[0]=240|(1835008&o)>>>18,s[1]=128|(258048&o)>>>12,s[2]=128|(4032&o)>>>6,s[3]=128|63&o):o>2048?(s[0]=224|(61440&o)>>>12,s[1]=128|(4032&o)>>>6,s[2]=128|63&o):o>128?(s[0]=192|(1984&o)>>>6,s[1]=128|63&o):s[0]=o,this.parsedData.push(s)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return e.prototype.getLength=function(t){return this.parsedData.length},e.prototype.write=function(t){for(var e=0,i=this.parsedData.length;i>e;e++)t.put(this.parsedData[e],8)},e}();t.QR8bitByte=e,__reflect(e.prototype,"qr.QR8bitByte")}(qr||(qr={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)
}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var qr;!function(t){var e=function(){function e(){}return e.create=function(i,n,s,o,r){void 0===n&&(n=0),void 0===s&&(s=200),void 0===o&&(o=200),void 0===r&&(r=2);var a={width:s,height:o,correctLevel:t.QRErrorCorrectLevel.H,color:n},h=new t.QRCodeModel(t.QRUtil._getTypeNumber(i,a.correctLevel),a.correctLevel);return h.addData(i),h.make(),e.draw(h,a)},e.draw=function(t,e){for(var i=new egret.Sprite,e=e,n=t.getModuleCount(),s=Math.floor(e.width/n),o=Math.floor(e.height/n),r=0;n>r;r++)for(var a=0;n>a;a++){var h=t.isDark(r,a);h&&(i.graphics.beginFill(e.color),i.graphics.drawRect(a*s,r*o,s,o),i.graphics.endFill())}return i},e}();t.QRCode=e,__reflect(e.prototype,"qr.QRCode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return e.prototype.addData=function(e){var i=new t.QR8bitByte(e);this.dataList.push(i),this.dataCache=null},e.prototype.isDark=function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},e.prototype.getModuleCount=function(){return this.moduleCount},e.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},e.prototype.makeImpl=function(t,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++)this.modules[n][s]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,i),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},e.prototype.setupPositionProbePattern=function(t,e){for(var i=-1;7>=i;i++)if(!(-1>=t+i||this.moduleCount<=t+i))for(var n=-1;7>=n;n++)-1>=e+n||this.moduleCount<=e+n||(i>=0&&6>=i&&(0==n||6==n)||n>=0&&6>=n&&(0==i||6==i)||i>=2&&4>=i&&n>=2&&4>=n?this.modules[t+i][e+n]=!0:this.modules[t+i][e+n]=!1)},e.prototype.getBestMaskPattern=function(){for(var e=0,i=0,n=0;8>n;n++){this.makeImpl(!0,n);var s=t.QRUtil.getLostPoint(this);(0==n||e>s)&&(e=s,i=n)}return i},e.prototype.createMovieClip=function(t,e,i){var n=t.createEmptyMovieClip(e,i),s=1;this.make();for(var o=0;o<this.modules.length;o++)for(var r=o*s,a=0;a<this.modules[o].length;a++){var h=a*s,c=this.modules[o][a];c&&(n.beginFill(0,100),n.moveTo(h,r),n.lineTo(h+s,r),n.lineTo(h+s,r+s),n.lineTo(h,r+s),n.endFill())}return n},e.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},e.prototype.setupPositionAdjustPattern=function(){for(var e=t.QRUtil.getPatternPosition(this.typeNumber),i=0;i<e.length;i++)for(var n=0;n<e.length;n++){var s=e[i],o=e[n];if(null==this.modules[s][o])for(var r=-2;2>=r;r++)for(var a=-2;2>=a;a++)-2==r||2==r||-2==a||2==a||0==r&&0==a?this.modules[s+r][o+a]=!0:this.modules[s+r][o+a]=!1}},e.prototype.setupTypeNumber=function(e){for(var i=t.QRUtil.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var s=!e&&1==(i>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=s}for(var n=0;18>n;n++){var s=!e&&1==(i>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=s}},e.prototype.setupTypeInfo=function(e,i){for(var n=this.errorCorrectLevel<<3|i,s=t.QRUtil.getBCHTypeInfo(n),o=0;15>o;o++){var r=!e&&1==(s>>o&1);6>o?this.modules[o][8]=r:8>o?this.modules[o+1][8]=r:this.modules[this.moduleCount-15+o][8]=r}for(var o=0;15>o;o++){var r=!e&&1==(s>>o&1);8>o?this.modules[8][this.moduleCount-o-1]=r:9>o?this.modules[8][15-o-1+1]=r:this.modules[8][15-o-1]=r}this.modules[this.moduleCount-8][8]=!e},e.prototype.mapData=function(e,i){for(var n=-1,s=this.moduleCount-1,o=7,r=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var h=0;2>h;h++)if(null==this.modules[s][a-h]){var c=!1;r<e.length&&(c=1==(e[r]>>>o&1));var p=t.QRUtil.getMask(i,s,a-h);p&&(c=!c),this.modules[s][a-h]=c,o--,-1==o&&(r++,o=7)}if(s+=n,0>s||this.moduleCount<=s){s-=n,n=-n;break}}},e.createData=function(i,n,s){for(var o=t.QRRSBlock.getRSBlocks(i,n),r=new t.QRBitBuffer,a=0;a<s.length;a++){var h=s[a];r.put(h.mode,4),r.put(h.getLength(),t.QRUtil.getLengthInBits(h.mode,i)),h.write(r)}for(var c=0,a=0;a<o.length;a++)c+=o[a].dataCount;if(r.getLengthInBits()>8*c)throw new Error("code length overflow. ("+r.getLengthInBits()+">"+8*c+")");for(r.getLengthInBits()+4<=8*c&&r.put(0,4);r.getLengthInBits()%8!=0;)r.putBit(!1);for(;!(r.getLengthInBits()>=8*c)&&(r.put(e.PAD0,8),!(r.getLengthInBits()>=8*c));)r.put(e.PAD1,8);return e.createBytes(r,o)},e.createBytes=function(e,i){for(var n=0,s=0,o=0,r=new Array(i.length),a=new Array(i.length),h=0;h<i.length;h++){var c=i[h].dataCount,p=i[h].totalCount-c;s=Math.max(s,c),o=Math.max(o,p),r[h]=new Array(c);for(var u=0;u<r[h].length;u++)r[h][u]=255&e.buffer[u+n];n+=c;var l=t.QRUtil.getErrorCorrectPolynomial(p),g=new t.QRPolynomial(r[h],l.getLength()-1),m=g.mod(l);a[h]=new Array(l.getLength()-1);for(var u=0;u<a[h].length;u++){var d=u+m.getLength()-a[h].length;a[h][u]=d>=0?m.get(d):0}}for(var _=0,u=0;u<i.length;u++)_+=i[u].totalCount;for(var f=new Array(_),E=0,u=0;s>u;u++)for(var h=0;h<i.length;h++)u<r[h].length&&(f[E++]=r[h][u]);for(var u=0;o>u;u++)for(var h=0;h<i.length;h++)u<a[h].length&&(f[E++]=a[h][u]);return f},e.PAD0=236,e.PAD1=17,e}();t.QRCodeModel=e,__reflect(e.prototype,"qr.QRCodeModel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.L=1,t.M=0,t.Q=3,t.H=2,t}();t.QRErrorCorrectLevel=e,__reflect(e.prototype,"qr.QRErrorCorrectLevel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.PATTERN000=0,t.PATTERN001=1,t.PATTERN010=2,t.PATTERN011=3,t.PATTERN100=4,t.PATTERN101=5,t.PATTERN110=6,t.PATTERN111=7,t}();t.QRMaskPattern=e,__reflect(e.prototype,"qr.QRMaskPattern")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.glog=function(e){return t.isInit||t.init(),1>e&&console.log("错误:n="+e),t.LOG_TABLE[e]},t.gexp=function(e){for(t.isInit||t.init();0>e;)e+=255;for(;e>=256;)e-=255;return t.EXP_TABLE[e]},t.init=function(){t.isInit=!0;for(var e=0;8>e;e++)t.EXP_TABLE[e]=1<<e;for(var e=8;256>e;e++)t.EXP_TABLE[e]=t.EXP_TABLE[e-4]^t.EXP_TABLE[e-5]^t.EXP_TABLE[e-6]^t.EXP_TABLE[e-8];for(var e=0;255>e;e++)t.LOG_TABLE[t.EXP_TABLE[e]]=e},t.EXP_TABLE=new Array(256),t.LOG_TABLE=new Array(256),t}();t.QRMath=e,__reflect(e.prototype,"qr.QRMath")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.MODE_NUMBER=1,t.MODE_ALPHA_NUM=2,t.MODE_8BIT_BYTE=4,t.MODE_KANJI=8,t}();t.QRMode=e,__reflect(e.prototype,"qr.QRMode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var i=0;i<t.length&&0==t[i];)i++;this.num=new Array(t.length-i+e);for(var n=0;n<t.length-i;n++)this.num[n]=t[n+i]}return e.prototype.get=function(t){return this.num[t]},e.prototype.getLength=function(){return this.num.length},e.prototype.multiply=function(i){for(var n=new Array(this.getLength()+i.getLength()-1),s=0;s<this.getLength();s++)for(var o=0;o<i.getLength();o++)n[s+o]^=t.QRMath.gexp(t.QRMath.glog(this.get(s))+t.QRMath.glog(i.get(o)));return new e(n,0)},e.prototype.mod=function(i){if(this.getLength()-i.getLength()<0)return this;for(var n=t.QRMath.glog(this.get(0))-t.QRMath.glog(i.get(0)),s=new Array(this.getLength()),o=0;o<this.getLength();o++)s[o]=this.get(o);for(var o=0;o<i.getLength();o++)s[o]^=t.QRMath.gexp(t.QRMath.glog(i.get(o))+n);return new e(s,0).mod(i)},e}();t.QRPolynomial=e,__reflect(e.prototype,"qr.QRPolynomial")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.totalCount=t,this.dataCount=e}return e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(t,i){var n=e.getRsBlockTable(t,i);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+i);for(var s=n.length/3,o=[],r=0;s>r;r++)for(var a=n[3*r+0],h=n[3*r+1],c=n[3*r+2],p=0;a>p;p++)o.push(new e(h,c));return o},e.getRsBlockTable=function(i,n){switch(n){case t.QRErrorCorrectLevel.L:return e.RS_BLOCK_TABLE[4*(i-1)+0];case t.QRErrorCorrectLevel.M:return e.RS_BLOCK_TABLE[4*(i-1)+1];case t.QRErrorCorrectLevel.Q:return e.RS_BLOCK_TABLE[4*(i-1)+2];case t.QRErrorCorrectLevel.H:return e.RS_BLOCK_TABLE[4*(i-1)+3];default:return}},e}();t.QRRSBlock=e,__reflect(e.prototype,"qr.QRRSBlock")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.getBCHTypeInfo=function(t){for(var i=t<<10;e.getBCHDigit(i)-e.getBCHDigit(e.G15)>=0;)i^=e.G15<<e.getBCHDigit(i)-e.getBCHDigit(e.G15);return(t<<10|i)^e.G15_MASK},e.getBCHTypeNumber=function(t){for(var i=t<<12;e.getBCHDigit(i)-e.getBCHDigit(e.G18)>=0;)i^=e.G18<<e.getBCHDigit(i)-e.getBCHDigit(e.G18);return t<<12|i},e.getBCHDigit=function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},e.getPatternPosition=function(t){return e.PATTERN_POSITION_TABLE[t-1]},e.getMask=function(e,i,n){switch(e){case t.QRMaskPattern.PATTERN000:return(i+n)%2==0;case t.QRMaskPattern.PATTERN001:return i%2==0;case t.QRMaskPattern.PATTERN010:return n%3==0;case t.QRMaskPattern.PATTERN011:return(i+n)%3==0;case t.QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(n/3))%2==0;case t.QRMaskPattern.PATTERN101:return i*n%2+i*n%3==0;case t.QRMaskPattern.PATTERN110:return(i*n%2+i*n%3)%2==0;case t.QRMaskPattern.PATTERN111:return(i*n%3+(i+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},e.getErrorCorrectPolynomial=function(e){for(var i=new t.QRPolynomial([1],0),n=0;e>n;n++)i=i.multiply(new t.QRPolynomial([1,t.QRMath.gexp(n)],0));return i},e.getLengthInBits=function(e,i){if(i>=1&&10>i)switch(e){case t.QRMode.MODE_NUMBER:return 10;case t.QRMode.MODE_ALPHA_NUM:return 9;case t.QRMode.MODE_8BIT_BYTE:return 8;case t.QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>i)switch(e){case t.QRMode.MODE_NUMBER:return 12;case t.QRMode.MODE_ALPHA_NUM:return 11;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>i))throw new Error("type:"+i);switch(e){case t.QRMode.MODE_NUMBER:return 14;case t.QRMode.MODE_ALPHA_NUM:return 13;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},e.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,n=0;e>n;n++)for(var s=0;e>s;s++){for(var o=0,r=t.isDark(n,s),a=-1;1>=a;a++)if(!(0>n+a||n+a>=e))for(var h=-1;1>=h;h++)0>s+h||s+h>=e||(0!=a||0!=h)&&r==t.isDark(n+a,s+h)&&o++;o>5&&(i+=3+o-5)}for(var n=0;e-1>n;n++)for(var s=0;e-1>s;s++){var c=0;t.isDark(n,s)&&c++,t.isDark(n+1,s)&&c++,t.isDark(n,s+1)&&c++,t.isDark(n+1,s+1)&&c++,(0==c||4==c)&&(i+=3)}for(var n=0;e>n;n++)for(var s=0;e-6>s;s++)t.isDark(n,s)&&!t.isDark(n,s+1)&&t.isDark(n,s+2)&&t.isDark(n,s+3)&&t.isDark(n,s+4)&&!t.isDark(n,s+5)&&t.isDark(n,s+6)&&(i+=40);for(var s=0;e>s;s++)for(var n=0;e-6>n;n++)t.isDark(n,s)&&!t.isDark(n+1,s)&&t.isDark(n+2,s)&&t.isDark(n+3,s)&&t.isDark(n+4,s)&&!t.isDark(n+5,s)&&t.isDark(n+6,s)&&(i+=40);for(var p=0,s=0;e>s;s++)for(var n=0;e>n;n++)t.isDark(n,s)&&p++;var u=Math.abs(100*p/e/e-50)/5;return i+=10*u},e.prototype.static_isSupportCanvas=function(){return"undefined"!=typeof CanvasRenderingContext2D},e._getTypeNumber=function(i,n){for(var s=1,o=e._getUTF8Length(i),r=0,a=e.QRCodeLimitLength.length;a>=r;r++){var h=0;switch(n){case t.QRErrorCorrectLevel.L:h=e.QRCodeLimitLength[r][0];break;case t.QRErrorCorrectLevel.M:h=e.QRCodeLimitLength[r][1];break;case t.QRErrorCorrectLevel.Q:h=e.QRCodeLimitLength[r][2];break;case t.QRErrorCorrectLevel.H:h=e.QRCodeLimitLength[r][3]}if(h>=o)break;s++}if(s>e.QRCodeLimitLength.length)throw new Error("Too long data");return s},e._getUTF8Length=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)},e.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],e.G15=1335,e.G18=7973,e.G15_MASK=21522,e.QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],e}();t.QRUtil=e,__reflect(e.prototype,"qr.QRUtil")}(qr||(qr={}));var RoleAvatar=function(){function t(t,e,i){if(void 0===i&&(i="dbxiaoren00"),this._armature=AssetManager.getDBArmature(i),null!=this._armature&&(this._headContainer=new egret.Sprite,this._head=new RoleHeadImage(e),this._head.x=.5*-this._head.width,this._head.y=.5*-this._head.height,this._headContainer.addChild(this._head),this._armature.replaceSlot("tou",this._headContainer),1!=t)){(null==t||void 0==t)&&(t=2);var n=this.getDbRes(t),s=this.getAvatarRes(t),o=function(){if(this._armature){var t=AssetManager.dbFactory.getArmatureData(n);if(t){var e=t.defaultSkin;this._armature.replaceSkin(e),this._armature.replaceSlot("tou",this._headContainer)}}}.bind(this);RES.getRes(s[0])?o():(App.ResourceUtils.createGroup(n,s),App.ResourceUtils.loadGroup(n,function(){AssetManager.loadDBAnimation([n]),o()},function(){},this))}}return Object.defineProperty(t.prototype,"avatarConfig",{get:function(){return RES.getRes("avatar_json")},enumerable:!0,configurable:!0}),t.prototype.getDbRes=function(t){var e=RES.getRes("avatar_json");return e.base[t].res},t.prototype.getAvatarRes=function(t){var e=this.getDbRes(t);return[e+"_ske_json",e+"_tex_json",e+"_tex_png"]},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._armature.dispose(),this._armature=null,this._head.dispose(),this._head=null},t}();__reflect(RoleAvatar.prototype,"RoleAvatar");var RoleHeadImage=function(t){function e(e,i,n,s){void 0===i&&(i="tou_png"),void 0===n&&(n=96),void 0===s&&(s=96);var o=t.call(this)||this;return o.userBase64=!1,o.imgUrl=e,o.maskRes=i,o.bitmap=new egret.Bitmap,o.bitmap.width=n,o.bitmap.height=s,o.bitmap.texture=RES.getRes("tou_png"),o.addChild(o.bitmap),o.imgUrl&&o.imgUrl.length?(o.LoadeAvatar(o.imgUrl,o),o):o}return __extends(e,t),e.prototype.setBitmap=function(t){this.bitmap&&t&&(this.bitmap.texture=t,this.maskRes&&(this.maskBitmap=App.DisplayUtils.createBitmap(this.maskRes),this.maskBitmap.width=this.bitmap.width,this.maskBitmap.height=this.bitmap.height,this.addChild(this.maskBitmap),this.bitmap.mask=this.maskBitmap,this.cacheAsBitmap=!0))},e.prototype.LoadeAvatar=function(t,e){var i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(t),i.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var i=new egret.Texture;i.bitmapData=t.currentTarget.data;var n=new egret.Bitmap(i);e.addChild(n),n.width=96,n.height=96,n.name="touxiang"}},this),this.maskRes&&(this.maskBitmap=App.DisplayUtils.createBitmap(this.maskRes),this.maskBitmap.width=this.bitmap.width,this.maskBitmap.height=this.bitmap.height,this.addChild(this.maskBitmap),this.bitmap.mask=this.maskBitmap,this.cacheAsBitmap=!0)},e.prototype.dispose=function(){this.removeChildren(),this.bitmap.texture=null,this.bitmap=null,this.maskBitmap&&(this.maskBitmap.texture=null,this.maskBitmap=null),this.userBase64&&Base64BitmapDataPool.reduceUseNum(this.imgUrl),this.cacheAsBitmap=!1},e}(egret.Sprite);__reflect(RoleHeadImage.prototype,"RoleHeadImage");var ErrorNote=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),"btn_return"==e?(this.btn_return=i,this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbuttonExitRoom,this)):"lab_content"==e||"btn_reconnect"==e&&(this.btn_reconnect=i,this.btn_reconnect.visible=!1,this.btn_reconnect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbuttonReconnRoom,this))},e.prototype.childrenCreated=function(){for(t.prototype.childrenCreated.call(this),this.height=this.stage.stageHeight,this.lab_userID.text="用户ID："+GameData.gameUser.id;GameData.intervalList.length>0;)clearTimeout(GameData.intervalList.pop())},e.prototype.SetErrorMsg=function(t){this.errMsg=t},e.prototype.showReconnect=function(){this.btn_reconnect.visible=!0},e.prototype.mbuttonReconnRoom=function(t){GameSceneView._gameScene.reconnectView()},e.prototype.mbuttonExitRoom=function(t){GameSceneView._gameScene.login()},e}(eui.Component);__reflect(ErrorNote.prototype,"ErrorNote",["eui.UIComponent","egret.DisplayObject"]);var ReconnectUI=function(t){function e(){var e=t.call(this)||this;return e._reconnctTimes=1,e._totalTimes=5,e.addMsResponseListen(),e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),"btn_return"==e&&(this.btn_return=i,this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbuttonExitRoom,this))},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._timer=new egret.Timer(1e3,5),this._timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this._timer.start()},e.prototype.addMsResponseListen=function(){mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_RECONNECT_RSP,this.reconnectResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_ERROR_RSP,this.errorResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,this.leaveRoomResponse,this),mvs.MsResponse.getInstance.addEventListener(mvs.MsEvent.EVENT_SENDEVENT_RSP,this.sendEventResponse,this)},e.prototype.release=function(){mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_ERROR_RSP,this.errorResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_LEAVEROOM_RSP,this.leaveRoomResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_SENDEVENT_RSP,this.sendEventResponse,this),mvs.MsResponse.getInstance.removeEventListener(mvs.MsEvent.EVENT_RECONNECT_RSP,this.reconnectResponse,this)},e.prototype.mbuttonExitRoom=function(t){GameSceneView._gameScene.login()},e.prototype.timerFunc=function(t){var e=mvs.MsEngine.getInstance.reconnect();this._reconnctTimes++,this._reconnctTimes>this._totalTimes&&(this._timer.stop(),0===e?(mvs.MsEngine.getInstance.leaveRoom(""),GameSceneView._gameScene.lobby()):(mvs.MsEngine.getInstance.leaveRoom(""),GameSceneView._gameScene.login()),this.release())},e.prototype.reconnectResponse=function(t){console.log("重新连接成功");var e=t.data,i=e.roomUserInfoList,n=e.roomInfo;this._timer.stop(),e.status&&200===e.status?(console.log("重连成功status:"+e.status+" 重连次数："+this._reconnctTimes),GameData.playerUserIds=[],GameData.playerUserIds.push(GameData.gameUser),i.forEach(function(t){if(console.log("用户ID："+t.userID),GameData.gameUser.id!==t.userID){var e={name:"",avatar:""};""!==t.userProfile&&(e=JSON.parse(t.userProfile));var i=new GameUser;i.avatar=e.avatar,i.name=e.name,i.id=t.userID,i.isOwner=t.userID==n.ownerId,GameData.playerUserIds.push(i)}}),GameData.roomPropertyValue=n.roomProperty,GameData.roomID=n.roomID,GameData.isRoomOwner=!1,GameData.playerUserIds.length===GameData.maxPlayerNum&&2===n.state?this.sendReadyEvent():(console.log("还没有开始游戏或者游戏结束, 退出到大厅"),mvs.MsEngine.getInstance.leaveRoom("leaveRoom"),this.release(),GameSceneView._gameScene.lobby())):(console.log("重连失败"+this._reconnctTimes),this.release(),GameSceneView._gameScene.lobby())},e.prototype.sendEventResponse=function(t){var e=t.data;if(200===e.status){var i=GameData.events[e.sequence];i&&i.action===GameData.reconnectReadyEvent&&(delete GameData.events[e.sequence],this.release(),GameSceneView._gameScene.play())}else this.release(),mvs.MsEngine.getInstance.leaveRoom("leaveRoom"),GameSceneView._gameScene.lobby()},e.prototype.errorResponse=function(t){this._timer.stop()},e.prototype.mbuttonCancleBtn=function(t){this._timer.stop(),this.release(),mvs.MsEngine.getInstance.leaveRoom("")},e.prototype.leaveRoomResponse=function(t){console.log("取消重新连接，离开房间:"+t.status)},e.prototype.sendReadyEvent=function(){var t={action:GameData.reconnectReadyEvent,userID:GameData.gameUser.id},e=mvs.MsEngine.getInstance.sendEvent(JSON.stringify(t));return e&&0===e.result?(GameData.events[e.sequence]=t,void console.log("重连发送信息成功")):(console.log("重连发送信息失败"),mvs.MsEngine.getInstance.leaveRoom("leaveRoom"),GameSceneView._gameScene.lobby(),void this.release())},e}(eui.Component);__reflect(ReconnectUI.prototype,"ReconnectUI",["eui.UIComponent","egret.DisplayObject"]);var Loading=function(t){function e(e,i){var n=t.call(this)||this;return n.logoUrl="resource/assets/loading_logo.png",n.isShow=!1,n.createView(e,i),n}return __extends(e,t),e.prototype.createView=function(t,e){this.w=t,this.h=e,this.textField=new egret.TextField,this.textField.y=this.h/2,this.textField.textColor=13421772,this.textField.size=46,this.textField.width=this.w,this.textField.height=100,this.textField.fontFamily="Black",this.textField.textAlign="center",this.textField.text="登录中…",this.textField_power=new egret.TextField,this.textField_power.text=".",this.textField_power.textColor=13421772,this.textField_power.size=80,this.textField_power.fontFamily="White",this.textField_power.textAlign="center",this.textField_power.x=.5*this.w,this.textField_power.y=.8*this.h,egret.Tween.get(this.textField_power,{loop:!0}).to({rotation:360},800,egret.Ease.cubicIn).play();var i=new egret.Shape;i.width=this.w,i.height=this.h,i.x=(this.w-i.width)/2,i.y=(this.h-i.height)/2,i.graphics.beginFill(3355443,.8),i.graphics.drawRect(0,0,this.w,this.h),i.graphics.endFill(),this.addChild(i),this.addChild(this.textField),this.addChild(this.textField_power),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("touch loading")},this)},e.prototype.setProgress=function(t,e){var i=Math.floor(t/e*100);this.textField.text="加载中…"+i+"%"},e.create=function(t){var i=new e(t.width,t.height);return i.context=t,i},e.prototype.show=function(){return this.isShow?void console.log("[INFO]  loading hande be show"):(this.isShow=!0,void this.context.addChild(this))},e.prototype.close=function(){return this.isShow?(this.isShow=!1,void this.context.removeChild(this)):void console.log("[INFO] loading is not  showoing")},e.prototype.reconnect=function(){var t=new eui.Button;t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/3*2,this.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameSceneView._gameScene.login()},this)},e}(egret.Sprite);__reflect(Loading.prototype,"Loading");var SoundBg=function(t){function e(){var e=t.call(this)||this;return e._currBg="",e}return __extends(e,t),e.prototype.mute=function(){this._currSoundChannel&&(this._currSoundChannel.volume=0)},e.prototype.restoreVolume=function(){this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},e.prototype.play=function(t,e){if(void 0===e&&(e=0),this._currBg!=t){this.stop(),this._currBg=t,this._currPlayTime=e;var i=this.getSound(t);i&&this.playSound(i)}},e.prototype.playSound=function(t){this._currSound=t,this._currSoundChannel=this._currSound.play(this._currPlayTime,0),this._currSoundChannel.volume=this._volume},e.prototype.getPlayTime=function(){return this._currSoundChannel?this._currSoundChannel.position:0},e.prototype.setVolume=function(t){this._volume=t,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.loadedPlay=function(t){this._currBg==t&&this.playSound(RES.getRes(t))},e.prototype.checkCanClear=function(t){return this._currBg!=t},e}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(t){function e(){var e=t.call(this)||this;return e._cacheSoundChannel=[],e._playingEffects={},e}return __extends(e,t),e.prototype.play=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=1),this._playTime=i,e||!this._playingEffects[t]){var n=this.getSound(t);n&&this.playSound(t,n)}},e.prototype.getSoundChannel=function(t){var e=null;return this._cacheSoundChannel.length?(e=this._cacheSoundChannel.pop(),e.isStopped=!1,e.$url=t.url,e.$loops=this._playTime,e.$audioBuffer=t.audioBuffer,e.$startTime=0,e.$play()):e=t.play(0,this._playTime),e},e.prototype.playSound=function(t,e){var i=this.getSoundChannel(e);i.once(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),i.volume=this._volume,i.soundName=t,this._playingEffects[t]=i},e.prototype.onSoundComplete=function(t){var e=t.currentTarget,i=e.soundName;delete this._playingEffects[i]},e.prototype.stopSound=function(t){var e=this._playingEffects[t];e&&(e.stop(),delete this._playingEffects[t])},e.prototype.setVolume=function(t){this._volume=t},e.prototype.loadedPlay=function(t){this.playSound(t,RES.getRes(t))},e}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(t){function e(){var e=t.call(this)||this;return e.bgOn=!0,e.effectOn=!0,e.bgVolume=.5,e.effectVolume=.7,e.bg=new SoundBg,e.bg.setVolume(e.bgVolume),e.effect=new SoundEffects,e.effect.setVolume(e.effectVolume),e}return __extends(e,t),e.prototype.playEffect=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=1),this.effectOn&&this.effect.play(t,e,i)},e.prototype.playBg=function(t){this.currBg=t,this.bgOn&&this.bg.play(t)},e.prototype.pauseBg=function(){this.bgOn&&(this.bgPlayTime=this.bg.getPlayTime(),this.bg.stop())},e.prototype.replayBg=function(){this.bgOn&&this.bg.play(this.currBg,this.bgPlayTime)},e.prototype.stopBg=function(){this.bg.stop()},e.prototype.muteBg=function(){this.bg.mute()},e.prototype.restoreVolumeBg=function(){this.bg.restoreVolume()},e.prototype.stopEffect=function(t){this.effect.stopSound(t)},e.prototype.setEffectOn=function(t){this.effectOn=t},e.prototype.setBgOn=function(t){this.bgOn!=t&&(this.bgOn=t,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg())},e.prototype.setBgVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.bgVolume=t,this.bg.setVolume(this.bgVolume)},e.prototype.getBgVolume=function(){return this.bgVolume},e.prototype.setEffectVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.effectVolume=t,this.effect.setVolume(this.effectVolume)},e.prototype.getEffectVolume=function(){return this.effectVolume},Object.defineProperty(e.prototype,"bgIsOn",{get:function(){return this.bgOn},enumerable:!0,configurable:!0}),e.CLEAR_TIME=18e4,e}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.loadBG=AssetManager.getBitmap("loadBG_jpg",!1,!1),(App.GameHeight>this.loadBG.height||App.GameHeight<this.loadBG.height)&&(this.loadBG.height=App.GameHeight,this.loadBG.anchorOffsetY=this.loadBG.height/2,this.loadBG.y=App.GameHeight/2),this.addChild(this.loadBG),this.numText=new egret.BitmapText;var t=RES.getRes("num_fnt");this.numText.font=t,this.numText.text="0%",this.numText.x=this.loadBG.width/2-this.numText.width/2,this.numText.y=this.loadBG.height/2+200,this.addChild(this.numText),this.loadDb=this.createLoadingDB(),this.loadDb.x=this.loadBG.width/2,this.loadDb.y=this.loadBG.height/2,this.addChild(this.loadDb)},e.prototype.createLoadingDB=function(){var t,e=RES.getRes("loading_ske_json"),i=RES.getRes("loading_tex_json"),n=RES.getRes("loading_tex_png");return e&&i&&n&&(AssetManager.loadDBAnimation(["loading"]),t=AssetManager.getDBArmature("loading"),t.scaleX=t.scaleY=2,t.play("newAnimation",0)),t},e.prototype.onProgress=function(t,e){this.numText.text=Math.ceil(t/e*100).toString()+"%","100%"==this.numText.text&&this.loadDb.dispose()},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var StateEvent=function(t){function e(e,i,n,s,o){void 0===s&&(s=!1),void 0===o&&(o=!1);
var r=t.call(this,e,s,o)||this;return r.data=i,r.paramData=n,r}return __extends(e,t),e.NEXT="NEXT",e.LAST="LAST",e.POPUP="POPUP",e.POPUPCLOSE="POPUPCLOSE",e}(egret.Event);__reflect(StateEvent.prototype,"StateEvent");var AssetManager=function(){function t(){}return t.clearCacheList=function(t){for(var e=this.cacheDbs[t]||[];e.length;){var i=e[0];i.dispose()}delete this.cacheDbs[t]},t.removeCacheArmature=function(t){var e=t.armatureName,i=this.cacheDbs[e];if(i){var n=i.indexOf(t);-1!=n&&i.splice(n,1)}this.printCacheListCount()},t.addCacheArmature=function(t){var e=t.armatureName;this.cacheDbs[e]||(this.cacheDbs[e]=[]),this.cacheDbs[e].push(t),this.printCacheListCount()},t.printCacheListCount=function(){return},t.getBitmap=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0);var n=new egret.Bitmap,s=RES.getRes(t);return n.texture=s,e&&(n.anchorOffsetX=n.width>>1),i&&(n.anchorOffsetY=n.height>>1),n},t.getSound=function(t){return RES.getRes(t)},t.loadDBAnimation=function(e){var i,n,s;for(i=0,n=e.length;n>i;i++){s=e[i];var o=RES.getRes(s+"_ske_json"),r=RES.getRes(s+"_tex_json"),a=RES.getRes(s+"_tex_png");o&&r&&a&&(t.dbFactory.parseDragonBonesData(o),t.dbFactory.parseTextureAtlasData(r,a))}},t.removeDBAnimation=function(e){var i,n,s;for(i=0,n=e.length;n>i;i++){s=e[i];var o=RES.getRes(s+"_ske_json");if(o){var r=o.name,a=t.dbFactory.getDragonBonesData(r);t.dbFactory.removeDragonBonesData(r),t.dbFactory.removeTextureAtlasData(r);for(var h in a.armatures)this.clearCacheList(h)}}},t.getDBArmature=function(e){var i=t.dbFactory.buildArmature(e);if(!i)return console.log("++++++++++++null"),null;var n=new DBArmature(i);return this.addCacheArmature(n),n},t.getQuickDBArmature=function(e){var i=t.dbFactory.buildArmature(e);if(!i)return null;i.cacheFrameRate=30;var n=new DBArmature(i);return this.addCacheArmature(n),n},t.changeTexture=function(t,e){var i=t.width,n=t.height;t.texture=RES.getRes(e),t.width=i,t.height=n},t.setText=function(t,e){t.text=e,t.anchorOffsetX=t.width>>1,t.anchorOffsetY=t.height>>1},t.dbFactory=new dragonBones.EgretFactory,t.cacheDbs={},t}();__reflect(AssetManager.prototype,"AssetManager");var Base64BitmapDataPool=function(){function t(){}return t.getData=function(t,e){var i=this,n=this.pools[t];if(n)n.useNum+=1,e(n.data);else{if(this.waitLoading[t])return void this.waitLoading[t].push(e);this.waitLoading[t]=[],this.waitLoading[t].push(e),ProxyHttp.wxImgToBase64(t,function(e){var n=e.r.data.split(",");egret.BitmapData.create("base64",n[1],function(e){var n=new egret.Texture;n._setBitmapData(e);var s={data:n,useNum:0};i.pools[t]=s;var o=i.waitLoading[t];o.forEach(function(t){s.useNum+=1,t(s.data)}),i.waitLoading[t]=null,delete i.waitLoading[t]})})}},t.reduceUseNum=function(t){var e=this.pools[t];e&&(e.useNum-=1)},t.pools={},t.waitLoading={},t}();__reflect(Base64BitmapDataPool.prototype,"Base64BitmapDataPool");var DisplayUtils=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createBitmap=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.createEuiImage=function(t){var e=new eui.Image,i=RES.getRes(t);return e.source=i,e},e.prototype.removeFromParent=function(t){null!=t.parent&&t.parent.removeChild(t)},e.prototype.quickAddChild=function(t,e){return"true"===egret.getOption("egretnative")?void t.addChild(e):void(e.$parent!=t&&(t.$children.push(e),e.$parent=t,e instanceof DBArmature&&e.$addToClock()))},e.prototype.quickRemoveChild=function(t){if("true"===egret.getOption("egretnative"))return void this.removeFromParent(t);var e=t.$parent;if(e){var i=e.$children.indexOf(t);e.$children.splice(i,1),t.$parent=null,t instanceof DBArmature&&t.$removeFromClock()}},e}(BaseClass);__reflect(DisplayUtils.prototype,"DisplayUtils");var GameReady=function(t){function e(e,i,n){void 0===i&&(i="ready_png"),void 0===n&&(n="go_png");var s=t.call(this)||this;return s._callback=e,s.imgReady=AssetManager.getBitmap(i),s.imgGo=AssetManager.getBitmap(n),s.addChild(s.imgReady),s.addChild(s.imgGo),s}return __extends(e,t),e.prototype.hide=function(){this.imgReady.alpha=0,this.imgGo.alpha=0},e.prototype.play=function(){var t=this;this.hide(),App.SoundManager.playEffect("readyGo_mp3"),this.imgReady.alpha=1,this.stepReady=setTimeout(function(){t.hide(),t.imgGo.alpha=1,t.stepGo=setTimeout(function(){t.hide(),t._callback(),clearTimeout(t.stepGo),t.stepGo=void 0},1e3),clearTimeout(t.stepReady),t.stepReady=void 0},1e3)},e.prototype.dispose=function(){this.stepReady&&(clearTimeout(this.stepReady),this.stepReady=void 0),this.stepGo&&(clearTimeout(this.stepGo),this.stepGo=void 0),this._callback=void 0,this.imgGo=void 0,this.imgReady=void 0},e}(egret.DisplayObjectContainer);__reflect(GameReady.prototype,"GameReady");var MD5=function(){function t(){this.hexcase=0,this.b64pad=""}return t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var n=Array(16),s=Array(16),o=0;16>o;o++)n[o]=909522486^i[o],s[o]=1549556828^i[o];var r=this.binl_md5(n.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(s.concat(r),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",s="",o=0;o<t.length;o++)i=t.charCodeAt(o),s+=n.charAt(i>>>4&15)+n.charAt(15&i);return s},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",s=t.length,o=0;s>o;o+=3)for(var r=t.charCodeAt(o)<<16|(s>o+1?t.charCodeAt(o+1)<<8:0)|(s>o+2?t.charCodeAt(o+2):0),a=0;4>a;a++)n+=8*o+6*a>8*t.length?this.b64pad:i.charAt(r>>>6*(3-a)&63);return n},t.prototype.rstr2any=function(t,e){var i,n,s,o,r,a=e.length,h=Array(Math.ceil(t.length/2));for(i=0;i<h.length;i++)h[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),p=Array(c);for(n=0;c>n;n++){for(r=Array(),o=0,i=0;i<h.length;i++)o=(o<<16)+h[i],s=Math.floor(o/a),o-=s*a,(r.length>0||s>0)&&(r[r.length]=s);p[n]=o,h=r}var u="";for(i=p.length-1;i>=0;i--)u+=e.charAt(p[i]);return u},t.prototype.str2rstr_utf8=function(t){for(var e,i,n="",s=-1;++s<t.length;)e=t.charCodeAt(s),i=s+1<t.length?t.charCodeAt(s+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),s++),127>=e?n+=String.fromCharCode(e):2047>=e?n+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n},t.prototype.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},t.prototype.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,n=-271733879,s=-1732584194,o=271733878,r=0;r<t.length;r+=16){var a=i,h=n,c=s,p=o;i=this.md5_ff(i,n,s,o,t[r+0],7,-680876936),o=this.md5_ff(o,i,n,s,t[r+1],12,-389564586),s=this.md5_ff(s,o,i,n,t[r+2],17,606105819),n=this.md5_ff(n,s,o,i,t[r+3],22,-1044525330),i=this.md5_ff(i,n,s,o,t[r+4],7,-176418897),o=this.md5_ff(o,i,n,s,t[r+5],12,1200080426),s=this.md5_ff(s,o,i,n,t[r+6],17,-1473231341),n=this.md5_ff(n,s,o,i,t[r+7],22,-45705983),i=this.md5_ff(i,n,s,o,t[r+8],7,1770035416),o=this.md5_ff(o,i,n,s,t[r+9],12,-1958414417),s=this.md5_ff(s,o,i,n,t[r+10],17,-42063),n=this.md5_ff(n,s,o,i,t[r+11],22,-1990404162),i=this.md5_ff(i,n,s,o,t[r+12],7,1804603682),o=this.md5_ff(o,i,n,s,t[r+13],12,-40341101),s=this.md5_ff(s,o,i,n,t[r+14],17,-1502002290),n=this.md5_ff(n,s,o,i,t[r+15],22,1236535329),i=this.md5_gg(i,n,s,o,t[r+1],5,-165796510),o=this.md5_gg(o,i,n,s,t[r+6],9,-1069501632),s=this.md5_gg(s,o,i,n,t[r+11],14,643717713),n=this.md5_gg(n,s,o,i,t[r+0],20,-373897302),i=this.md5_gg(i,n,s,o,t[r+5],5,-701558691),o=this.md5_gg(o,i,n,s,t[r+10],9,38016083),s=this.md5_gg(s,o,i,n,t[r+15],14,-660478335),n=this.md5_gg(n,s,o,i,t[r+4],20,-405537848),i=this.md5_gg(i,n,s,o,t[r+9],5,568446438),o=this.md5_gg(o,i,n,s,t[r+14],9,-1019803690),s=this.md5_gg(s,o,i,n,t[r+3],14,-187363961),n=this.md5_gg(n,s,o,i,t[r+8],20,1163531501),i=this.md5_gg(i,n,s,o,t[r+13],5,-1444681467),o=this.md5_gg(o,i,n,s,t[r+2],9,-51403784),s=this.md5_gg(s,o,i,n,t[r+7],14,1735328473),n=this.md5_gg(n,s,o,i,t[r+12],20,-1926607734),i=this.md5_hh(i,n,s,o,t[r+5],4,-378558),o=this.md5_hh(o,i,n,s,t[r+8],11,-2022574463),s=this.md5_hh(s,o,i,n,t[r+11],16,1839030562),n=this.md5_hh(n,s,o,i,t[r+14],23,-35309556),i=this.md5_hh(i,n,s,o,t[r+1],4,-1530992060),o=this.md5_hh(o,i,n,s,t[r+4],11,1272893353),s=this.md5_hh(s,o,i,n,t[r+7],16,-155497632),n=this.md5_hh(n,s,o,i,t[r+10],23,-1094730640),i=this.md5_hh(i,n,s,o,t[r+13],4,681279174),o=this.md5_hh(o,i,n,s,t[r+0],11,-358537222),s=this.md5_hh(s,o,i,n,t[r+3],16,-722521979),n=this.md5_hh(n,s,o,i,t[r+6],23,76029189),i=this.md5_hh(i,n,s,o,t[r+9],4,-640364487),o=this.md5_hh(o,i,n,s,t[r+12],11,-421815835),s=this.md5_hh(s,o,i,n,t[r+15],16,530742520),n=this.md5_hh(n,s,o,i,t[r+2],23,-995338651),i=this.md5_ii(i,n,s,o,t[r+0],6,-198630844),o=this.md5_ii(o,i,n,s,t[r+7],10,1126891415),s=this.md5_ii(s,o,i,n,t[r+14],15,-1416354905),n=this.md5_ii(n,s,o,i,t[r+5],21,-57434055),i=this.md5_ii(i,n,s,o,t[r+12],6,1700485571),o=this.md5_ii(o,i,n,s,t[r+3],10,-1894986606),s=this.md5_ii(s,o,i,n,t[r+10],15,-1051523),n=this.md5_ii(n,s,o,i,t[r+1],21,-2054922799),i=this.md5_ii(i,n,s,o,t[r+8],6,1873313359),o=this.md5_ii(o,i,n,s,t[r+15],10,-30611744),s=this.md5_ii(s,o,i,n,t[r+6],15,-1560198380),n=this.md5_ii(n,s,o,i,t[r+13],21,1309151649),i=this.md5_ii(i,n,s,o,t[r+4],6,-145523070),o=this.md5_ii(o,i,n,s,t[r+11],10,-1120210379),s=this.md5_ii(s,o,i,n,t[r+2],15,718787259),n=this.md5_ii(n,s,o,i,t[r+9],21,-343485551),i=this.safe_add(i,a),n=this.safe_add(n,h),s=this.safe_add(s,c),o=this.safe_add(o,p)}return[i,n,s,o]},t.prototype.md5_cmn=function(t,e,i,n,s,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(n,o)),s),i)},t.prototype.md5_ff=function(t,e,i,n,s,o,r){return this.md5_cmn(e&i|~e&n,t,e,s,o,r)},t.prototype.md5_gg=function(t,e,i,n,s,o,r){return this.md5_cmn(e&n|i&~n,t,e,s,o,r)},t.prototype.md5_hh=function(t,e,i,n,s,o,r){return this.md5_cmn(e^i^n,t,e,s,o,r)},t.prototype.md5_ii=function(t,e,i,n,s,o,r){return this.md5_cmn(i^(e|~n),t,e,s,o,r)},t.prototype.safe_add=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(MD5.prototype,"MD5");var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e,i){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];t._content[i]||(t._content[i]=[]);var o=t._content[i];if(o.length)return o.pop();var r,a=n.length;return 0==a?r=new e:1==a?r=new e(n[0]):2==a?r=new e(n[0],n[1]):3==a?r=new e(n[0],n[1],n[2]):4==a?r=new e(n[0],n[1],n[2],n[3]):5==a&&(r=new e(n[0],n[1],n[2],n[3],n[4])),r.ObjectPoolKey=i,r},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var n,s=t._content[e];if(s.length)for(var o=0;o<s.length;o++)if(s[o].extraKey==i){n=s[o],s.splice(o,1);break}if(!n){var r=e;n=new r(i),n.extraKey=i,n.ObjectPoolKey=e}return n},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return t._content[i]?(t._content[i].push(e),!0):!1},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var n=t._content[e];n&&n.length;){var s=n.pop();i&&s[i](),s=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var n=t._content[e];if(null!=n){var s=0,o=n.length;for(s;o>s;s++)n[s][i]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var ProxyHttp=function(){function t(){}return t.wxImgToBase64=function(t,e){},t}();__reflect(ProxyHttp.prototype,"ProxyHttp");var ResourceUtils=function(t){function e(){var e=t.call(this)||this;return e._groupIndex=0,e._configs=new Array,e._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,e.onResourceLoadComplete,e),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,e.onResourceLoadProgress,e),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,e.onResourceLoadError,e),e}return __extends(e,t),e.prototype.addConfig=function(t,e){this._configs.push([t,e])},e.prototype.loadConfig=function(t,e){this._onConfigComplete=t,this._onConfigCompleteTarget=e,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var t=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},e.prototype.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroup=function(t,e,i,n,s){void 0===s&&(s=null),this._groups[t]=[e,i,n,s],RES.loadGroup(t)},e.prototype.loadGroups=function(t,e,i,n,s,o){void 0===o&&(o=null),RES.createGroup(t,e,!0),this.loadGroup(t,i,n,s,o)},e.prototype.pilfererLoadGroup=function(t,e){void 0===e&&(e=null);var i="pilferer_"+t;e||(e=[t]),RES.createGroup(i,e,!0),RES.loadGroup(i,-1)},e.prototype.onResourceLoadComplete=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][0],n=this._groups[e][2];null!=i&&i.apply(n,[e]),this._groups[e]=null,delete this._groups[e]}},e.prototype.onResourceLoadProgress=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][1],n=this._groups[e][2];null!=i&&i.call(n,t.itemsLoaded,t.itemsTotal)}},e.prototype.onResourceLoadError=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][2],n=this._groups[e][3];null!=n&&n.apply(i,[e])}},e.prototype.createGroup=function(t,e){RES.createGroup(t,e,!0)},e}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var StageUtils=function(t){function e(){var i=t.call(this)||this;return null==e._uiStage&&(e._uiStage=new eui.UILayer,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,e._uiStage.touchEnabled=!1,i.getStage().addChild(e._uiStage)),i}return __extends(e,t),e.prototype.getHeight=function(){return this.getStage().stageHeight},e.prototype.getWidth=function(){return this.getStage().stageWidth},e.prototype.setTouchChildren=function(t){this.getStage().touchChildren=t},e.prototype.setMaxTouches=function(t){this.getStage().maxTouches=t},e.prototype.setFrameRate=function(t){this.getStage().frameRate=t},e.prototype.setScaleMode=function(t){this.getStage().scaleMode=t},e.prototype.getStage=function(){return egret.MainContext.instance.stage},e.prototype.getUIStage=function(){return e._uiStage},e.prototype.startFullscreenAdaptation=function(t,e,i){this.designWidth=t,this.designHeight=e,this.resizeCallback=i,this.stageOnResize()},e.prototype.stageOnResize=function(){this.getStage().removeEventListener(egret.Event.RESIZE,this.stageOnResize,this);var t=this.designWidth,e=this.designHeight,i=window.innerWidth,n=window.innerHeight,s=i/n,o=t/e,r=s/o;if(s>o){var a=r,h=r;t=Math.floor(t*a),e=Math.floor(e*h)}this.getStage().setContentSize(t,e),this.resizeCallback&&this.resizeCallback(),this.getStage().addEventListener(egret.Event.RESIZE,this.stageOnResize,this)},e}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var TimerManager=function(t){function e(){var e=t.call(this)||this;return e._handlers=new Array,e._delHandlers=new Array,e._currTime=egret.getTimer(),e._currFrame=0,e._count=0,e._timeScale=1,egret.Ticker.getInstance().register(e.onEnterFrame,e),e}return __extends(e,t),e.prototype.setTimeScale=function(t){this._timeScale=t},e.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer();for(var t=0;t<this._count;t++){var e=this._handlers[t],i=e.userFrame?this._currFrame:this._currTime;i>=e.exeTime&&(e.method.call(e.methodObj,(this._currTime-e.dealTime)*this._timeScale),e.dealTime=this._currTime,e.exeTime+=e.delay,e.repeat||(e.repeatCount>1?e.repeatCount--:(e.complateMethod&&e.complateMethod.apply(e.complateMethodObj),this._delHandlers.push(e))))}for(;this._delHandlers.length;){var e=this._delHandlers.pop();this.remove(e.method,e.methodObj)}},e.prototype.create=function(t,e,i,n,s,o,r){if(!(0>e||0>i||null==n)){this.remove(n,s);var a=ObjectPool.pop(TimerHandler,"TimerHandler");a.userFrame=t,a.repeat=0==i,a.repeatCount=i,a.delay=e,a.method=n,a.methodObj=s,a.complateMethod=o,a.complateMethodObj=r,a.exeTime=e+(t?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},e.prototype.doTimer=function(t,e,i,n,s,o){void 0===s&&(s=null),void 0===o&&(o=null),this.create(!1,t,e,i,n,s,o)},e.prototype.doFrame=function(t,e,i,n,s,o){void 0===s&&(s=null),void 0===o&&(o=null),this.create(!0,t,e,i,n,s,o)},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.remove=function(t,e){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==t&&n.methodObj==e){this._handlers.splice(i,1),ObjectPool.push(n),this._count--;break}}},e.prototype.removeAll=function(t){for(var e=0;e<this._count;e++){var i=this._handlers[e];i.methodObj==t&&(this._handlers.splice(e,1),ObjectPool.push(i),this._count--,e--)}},e.prototype.isExists=function(t,e){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==t&&n.methodObj==e)return!0}return!1},e}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return t.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},t}();__reflect(TimerHandler.prototype,"TimerHandler");var Toast=function(t){function e(i,n,s){var o=t.call(this)||this;console.log("Toast:",i);var r=new egret.Bitmap(e._txtrToastBg);o.x=.5*n,o.y=.85*s,o.addChild(r),r.$anchorOffsetX=r.width/2;var a=new egret.TextField;return a.multiline=!0,a.size=30,a.bold=!0,a.textColor=16777215,a.stroke=6,a.strokeColor=0,a.text=i,a.fontFamily="微软雅黑",a.textAlign=egret.HorizontalAlign.CENTER,a.width=1*n,a.x=r.x,a.y=r.y+a.size/10,a.anchorOffsetX=a.width/2,o.addChild(a),r.height=12+a.height,o.alpha=0,egret.Tween.get(o).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){o.parent&&o.parent.removeChild(o)}),o}return __extends(e,t),e.init=function(t,e){console.log("Toast.init",e),this._cont=t,this._txtrToastBg=e},e.initRes=function(t,e){console.log("Toast.init",e),this._cont=t;var i=new egret.ImageLoader;i.addEventListener(egret.Event.COMPLETE,function(t){var e=t.target,i=e.data,n=new egret.Texture;n.bitmapData=i,this._txtrToastBg=n},this),i.load(e)},e.show=function(t){if(this._cont){var i=new e(t,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i)}},e}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");